(function(a,b){a.widget("RUI.RCombo",{options:{dataUrl:"",staticData:"",valueField:null,displayField:null,icon:true,readonly:false,multiSelect:false,showTips:false,ifEditGrid:false,beforeSelect:null,afterSelect:null,isCache:false},ID:"",paramFn:null,afterFn:null,checkVal:[],checkText:[],setparam:{},ifsetVal:true,_create:function(){var c=this},_init:function(){var f=this;var c=f.element.context.id;var j=a("#"+c).attr("check");var m;if(j==b){j=""}f.ID=c+"_wrap";a('ul[for="'+f.ID+'"]').remove();a("#"+c).wrap('<div id="'+c+'_wrap" style="width:100%;position:relative;"></div>');if(f.options.readonly==false){m=""}else{m="disabled"}var l=a('<span class="combo_text"><input '+m+' type="text" placeholder="请选择..."></span>');if(f.options.icon==true){l.append(a("<span></span>"))}a("#"+f.ID).append(l);var d=a('<ul for="'+f.ID+'" class="item_list item_display"></ul>');a("body").append(d);if(f.options.multiSelect==true){a("#"+f.ID).append('<input type="hidden" class="hid_val" name="'+a("#"+c).attr("name")+'" check="'+j+'"/>');a("#"+c).removeAttr("name")}if(f.options.showTips==true){var e=a("#"+c).attr("check");var i=e.split(",");var h=[];for(var g=0;g<i.length;g++){h=i[g].split(":");if(h[0]=="required"){a("#"+f.ID).prepend('<span class="tips">*</span>')}}a("#"+f.ID+" span.tips").parent("div").css("outline","none")}f.checkText=[];f.checkVal=[];f.inputToCollapse();f.mouseToCollapse();f.clickOtherToHideTable();if(f.options.beforeSelect){this.paramFn=f.options.beforeSelect}if(f.options.afterSelect){this.afterFn=f.options.afterSelect}if(f.options.readonly==true){a("#"+c+" .combo_text").css("background-color","#EEEEEE")}else{a("#"+c+" .combo_text").css("background-color","white")}},getData:function(){var e=this;var f=[];var k;var d;if(!a.isEmptyObject(e.setparam)){f=[];f[0]={};for(var j in e.setparam){f[0][j]=e.setparam[j]}}if(e.paramFn!=null){f=e.paramFn();if(f[1]){e.options.valueField=f[1][0];e.options.displayField=f[1][1]}}if(e.options.dataUrl!=""){var h="";for(var i in f[0]){h+=i+"="+f[0][i]+"&"}var c=e.options.dataUrl+"?"+h;var l=window.sessionStorage.getItem(c);if(l&&e.options.isCache){l=JSON.parse(l);e.setSelectItem(l);e.setUlItem(l)}else{a.ajax({url:e.options.dataUrl,type:"POST",async:false,data:f[0],dataType:"JSON",cache:false,success:function(n){if(n){e.setSelectItem(n);e.setUlItem(n)}var m;if(this.data){m=this.url+"?"+this.data+"&"}else{m=this.url+"?"}var o=JSON.stringify(n);window.sessionStorage[m]=o},error:function(){}})}}else{var g=e.options.staticData;if(!this.isJson(g)){g=JSON.parse(g.replace(/'/g,'"'))}e.setSelectItem(g);e.setUlItem(g)}},isJson:function(d){var c=typeof(d)=="object";return c},setSelectItem:function(g){var e=this;var c=e.element.context.id;var d=e.options.valueField;var o=e.options.displayField;var l="";for(var h=0;h<g.length;h++){var n="";for(var f=0;f<e.checkVal.length;f++){if(g[h][d]==e.checkVal[f]){n='selected="selected"'}}l+='<option value="'+g[h][d]+'" '+n+">"+g[h][o]+"</option>"}a("#"+c).html("<option></option>"+l);var m;if(e.options.multiSelect==false){m=a("#"+e.ID+" .combo_text input").val();if(a.trim(m)!=""){a("#"+c+" option").each(function(){var i=this;if(a(i).html()==m&&a("#"+e.ID+" select").attr("value")){a("#"+c).val(a(i).val());a(i).attr("selected",true)}})}}else{m=a("#"+e.ID+" select").attr("value");a("#"+e.ID+" input[type=hidden]").attr("value",m);if(a.trim(m)!=""&&e.ifsetVal){var j=m.split(",");a("#"+c+" option").each(function(){for(var i=0;i<j.length;i++){if(a(this).attr("value")==j[i]){a(this).attr("selected",true);if(a.inArray(a(this).html(),e.checkText)==-1){e.checkText.push(a(this).html())}}}});a("#"+e.ID+" input[type=text]").attr("value",e.checkText.join(","))}}},setUlItem:function(g){var e=this;var d=e.options.valueField;var m=e.options.displayField;var j="";var n=a('ul[for="'+e.ID+'"]');if(e.options.multiSelect==true){for(var h=0;h<g.length;h++){var l="";for(var f=0;f<e.checkVal.length;f++){if(g[h][d]==e.checkVal[f]){l='checked="checked"'}}j+='<li value="'+g[h][d]+'"><input type="checkbox" '+l+"/><span>"+g[h][m]+"</span></li>"}n.html(j);e.checkToSelect()}else{for(var h=0;h<g.length;h++){j+='<li value="'+g[h][d]+'">'+g[h][m]+"</li>"}n.html(j);e.keyToSelect();e.mouseToSelect();var c=(a("#"+e.ID+" option[selected=selected]").index()-1)>=0?(a("#"+e.ID+" option[selected=selected]").index()-1):0;e.highLight('ul[for="'+e.ID+'"] li:eq('+c+")")}e.delText();n.css("width",a("#"+e.ID+" span.combo_text").width())},checkToSelect:function(){var d=this;var c=a('ul[for="'+d.ID+'"]');c.find("li").each(function(){var e=this;a(this).bind("mouseover",function(){d.highLight(e)});a(this).bind("click",function(k){var k=k||window.event;if(a(this).find(":checkbox").is(":checked")){for(var h=0;h<d.checkVal.length;h++){if(d.checkVal[h]==a(this).attr("value")){d.checkVal.splice(h,1)}if(d.checkText[h]==a(this).find(":checkbox").siblings("span").html()){d.checkText.splice(h,1)}}a(this).find(":checkbox").prop("checked",false)}else{if(a.inArray(a(this).attr("value"),d.checkVal)==-1){d.checkText.push(a(this).find(":checkbox").siblings("span").html());d.checkVal.push(a(this).attr("value"))}a(this).find(":checkbox").prop("checked",true)}a("#"+d.ID+" select option").each(function(){a(this).attr("selected",false);for(var i=0;i<d.checkVal.length;i++){if(a(this).attr("value")==d.checkVal[i]){a(this).attr("selected",true)}}});a("#"+d.ID+" input[type=text]").val(d.checkText.join(","));a("#"+d.ID+" input[type=hidden]").attr("value",d.checkVal.join(","));a("#"+d.ID+" select").attr("value",d.checkVal.join(","));if(d.options.ifEditGrid==true){var j=a("#"+d.ID).closest("tr");var g=a("#"+d.ID).closest("form").attr("id");var f=g.substring(0,g.length-5);if(j.hasClass("editing")){a("#"+f).EditableGrid("saveValue","editing")}else{a("#"+f).EditableGrid("saveValue","adding")}}k.stopPropagation()})});c.find(":checkbox").each(function(){a(this).bind("click",function(j){var j=j||window.event;if(!a(this).is(":checked")){for(var g=0;g<d.checkVal.length;g++){if(d.checkVal[g]==a(this).parent("li").attr("value")){d.checkVal.splice(g,1)}if(d.checkText[g]==a(this).siblings("span").html()){d.checkText.splice(g,1)}}}else{if(a.inArray(a(this).attr("value"),d.checkVal)==-1){d.checkText.push(a(this).siblings("span").html());d.checkVal.push(a(this).parent("li").attr("value"))}}a("#"+d.ID+" select option").each(function(){a(this).attr("selected",false);for(var i=0;i<d.checkVal.length;i++){if(a(this).attr("value")==d.checkVal[i]){a(this).attr("selected",true)}}});a("#"+d.ID+" input[type=text]").val(d.checkText.join(","));a("#"+d.ID+" input[type=hidden]").attr("value",d.checkVal.join(","));a("#"+d.ID+" select").attr("value",d.checkVal.join(","));if(d.options.ifEditGrid==true){var h=a("#"+d.ID).closest("tr");var f=a("#"+d.ID).closest("form").attr("id");var e=f.substring(0,f.length-5);if(h.hasClass("editing")){a("#"+e).EditableGrid("saveValue","editing")}else{a("#"+e).EditableGrid("saveValue","adding")}}j.stopPropagation()})})},mouseToSelect:function(){var d=this;var c=a('ul[for="'+d.ID+'"]');c.find("li").each(function(){var e=this;a(this).bind("mouseover",function(){d.highLight(e)});a(this).click(function(f){var f=f||window.event;d.selectVal(e);c.addClass("item_display");f.stopPropagation()})})},keyToSelect:function(){var e=this;var d=0;var c=a('ul[for="'+e.ID+'"]');a("#"+e.ID).unbind("keydown");a("#"+e.ID).bind("keydown",function(g){var g=g||window.event;if(g.keyCode==13){e.selectVal('ul[for="'+e.ID+'"] li.item_active');e.toCollapse();return false}else{if(g.keyCode==38){d=c.find("li.item_active").index()-1;var f=d%c.find("li").length;e.highLight(c.find("li:eq("+f+")"));return false}else{if(g.keyCode==40){d=c.find("li.item_active").index()+1;var f=d%c.find("li").length;e.highLight(c.find("li:eq("+f+")"));return false}}}})},delText:function(){var c=this;a("#"+c.ID+" input").bind("keyup",function(d){var d=d||window.event;if(d.keyCode!=13&&d.keyCode!=40&&d.keyCode!=38){a("#"+c.ID+" input").val("");a("#"+c.ID+" select").attr("value","");a("#"+c.ID+" select option").attr("selected",false);a("input[type=hidden]").val("");c.checkText=[];c.checkVal=[]}})},selectVal:function(i){var h=this;var f=a(i).html();f=f.replace(/&lt;/g,"<");f=f.replace(/&gt;/g,">");a("#"+h.ID+" .combo_text input").val(f);var e=a(i).index();var j=h.element.context.id;a("#"+j+" select").attr("value","");a("#"+j+" option").attr("selected",false);a("#"+j+" option").eq(e+1).attr("selected",true);a("#"+j).val(a("#"+j+" option").eq(e+1).val());h.checkVal=[];h.checkVal.push(a("#"+j+" option").eq(e+1).val());if(h.options.ifEditGrid==true){var g=a("#"+h.ID).closest("tr");var d=a("#"+h.ID).closest("form").attr("id");var c=d.substring(0,d.length-5);if(g.hasClass("editing")){a("#"+c).EditableGrid("saveValue","editing")}else{a("#"+c).EditableGrid("saveValue","adding")}}if(h.afterFn!=null){h.afterFn([a("#"+j+" option").eq(e+1).val(),a(i).html()])}},highLight:function(d){var e=this;var c=a('ul[for="'+e.ID+'"]');c.find("li").removeClass("item_active");a(d).addClass("item_active")},mouseToCollapse:function(){var d=this;var e=d.ID;var c=a('[for="'+d.ID+'"]');if(d.options.icon==true){a("#"+d.ID+" .combo_text span").unbind("click");a("#"+d.ID+" .combo_text span").bind("click",function(f){var f=f||window.event;if(c.hasClass("item_display")==true){d.getData()}d.toCollapse();f.stopPropagation()})}},inputToCollapse:function(){var d=this;var e=d.ID;var c=a('ul[for="'+d.ID+'"]');a("#"+d.ID+" .combo_text input").unbind("click");a("#"+d.ID+" .combo_text input").bind("click",function(f){var f=f||window.event;if(c.hasClass("item_display")==true){d.getData()}d.toCollapse();f.stopPropagation()})},toCollapse:function(){var d=this;var c=a('ul[for="'+d.ID+'"]');var f=a("#"+d.ID).offset().top+30;var e=a("#"+d.ID).offset().left;c.css({top:f,left:e});a("div.table_wrap").addClass("collapse_table");a("ul.item_list").not('ul[for="'+d.ID+'"]').addClass("item_display");if(d.options.readonly==false){c.toggleClass("item_display")}},setAllValue:function(c){var f=this;var g=f.ID;if(f.options.multiSelect){var d="";f.checkVal=c[0].split(",");f.checkText=c[1].split(",");a("#"+g+" select").html('<option value="'+c[0]+'" selected="selected">'+c[1]+"</option>");a("#"+g).children("input[type=hidden]").attr("value",c[0].split(","))}else{a("#"+g+" select").attr("value",c[0]);a("#"+g+" select").html('<option value="'+c[0]+'" selected="selected">'+c[1]+"</option>")}var e=c[1];e=e.replace(/&lt;/g,"<");e=e.replace(/&gt;/g,">");a("#"+g+" .combo_text input").val(e)},getValue:function(){var c=this;var e=c.element.context.id;var d="";if(c.options.multiSelect){d=a("#"+e+"_wrap").find(".hid_val").attr("value")}else{d=a("#"+e).val()}return d},setValue:function(d){var c=this;var e=c.element.context.id;var d=a("#"+e).attr("value");if(d){d=d}if(a.trim(d)!=""){c.getData();if(c.options.multiSelect){c.checkVal=d.split(",")}a("#"+e+" option").each(function(){var g=this;if(a(g).html()==d||a(g).attr("value")==d){var f=a(g).html();a("#"+e).val(a(g).val());a(g).attr("selected",true);f=f.replace(/&lt;/g,"<");f=f.replace(/&gt;/g,">");a("#"+c.ID+" .combo_text input").val(f)}})}else{a("#"+e+" option").each(function(){a(this).attr("selected",false)});a("#"+c.ID+" .combo_text input").val("")}},clickOtherToHideTable:function(){var d=this;var c=a('ul[for="'+d.ID+'"]');a("body").bind("click",function(){c.addClass("item_display")})},setParam:function(c){this.setparam=c},beforeSelect:function(c){this.paramFn=c},afterSelect:function(c){this.afterFn=c},setCheck:function(h){var f=this;var i=f.element.context.id;a("#"+i).attr("check",h);if(f.options.multiSelect==true){a("#"+f.ID).find("input[type=hidden]").attr("check",h)}a("#"+f.ID).find("span.tips").remove();var d=a("#"+i).attr("check");var g=d.split(",");var c=[];for(var e=0;e<g.length;e++){c=g[e].split(":");if(c[0]=="required"){a("#"+f.ID).prepend('<span class="tips">*</span>')}}a("#"+f.ID+" span.tips").parent("div").css("outline","none")},setReadOnly:function(d){var e=this;var f=e.ID;var c=a('ul[for="'+e.ID+'"]');if(d==true){e.options.readonly=true;a("#"+f+" .combo_text").css("background-color","#EEEEEE");a("#"+f+" .combo_text input").prop("disabled","disabled");c.css("display","none")}else{e.options.readonly=false;a("#"+f+" .combo_text").css("background-color","white");a("#"+f+" .combo_text input").removeAttr("disabled");c.css("display","")}},changeStaticData:function(c){this.options.staticData=c},destroy:function(){a.Widget.prototype.destroy.call(this)}})})(jQuery);(function(a,b){a.widget("RUI.RComboGrid",{options:{panelWidth:"300",panelHeight:"175",idField:"",textField:"",url:"",method:"post",pageSize:"6",columns:[],icon:true,readonly:false,multiSelect:false,showText:false,showTips:false,ifEditGrid:false,isWrite:false,beforeSelect:null,afterSelect:null,isCache:false},ID:"",paramFn:null,afterFn:null,compareFn:null,checkText:[],checkVal:[],setparam:{},_create:function(){var c=this},_init:function(){var e=this;var c=e.element.context.id;var l;e.checkVal=[];e.checkText=[];a("#"+c).wrap('<div id="'+c+'_wrap"></div>');a("#"+c).attr({hid:c,combogrid:true});c=c+"_wrap";e.ID=c;a('div[for="'+e.ID+'"]').remove();if(e.options.readonly==false){l=""}else{l="disabled"}if(e.options.icon==true){a("#"+c).append('<div class="text_box"><input type="text" '+l+' class="input_text input_text_w" placeholder="请选择..."/><span class="tocollapse"></span></div>')}else{a("#"+c).append('<div class="text_box"><input type="text" '+l+' class="input_text" placeholder="请选择..."/></div>')}a("#"+c+" .input_text").attr("check",a("#"+c+" input[type=hidden]").attr("check"));a("body").append('<div for="'+e.ID+'" class="table_wrap collapse_table"><div class="data_panel"><div class="data_table"><table cellpadding="0" cellspacing="0"></table></div><div class="combogrid_page"></div></div>');a("#"+c).css("position","relative");var m=a('div[for="'+e.ID+'"]');m.css("width",e.options.panelWidth);m.find(".data_table").css("height",e.options.panelHeight);m.find(".data_table table").append("<thead></thead>");for(var g=0;g<e.options.columns.length;g++){if(e.options.multiSelect==true){m.find(".data_panel .data_table thead").append('<th class="number"></th><th class="chkCol"></th><th>'+e.options.columns[g].title+"</th>")}else{m.find(".data_panel .data_table thead").append('<th class="number"></th><th>'+e.options.columns[g].title+"</th>")}}if(e.options.showTips==true){var d=a("#"+c+" input[type=hidden]").attr("check");var j=d.split(",");var h=[];for(var f=0;f<j.length;f++){h=j[f].split(":");if(h[0]=="required"){a("#"+e.ID).prepend('<span class="tips">*</span>')}}a("#"+e.ID+" span.tips").parent("div").css("outline","none")}if(e.options.beforeSelect){this.paramFn=e.options.beforeSelect}if(e.options.afterSelect){this.afterFn=e.options.afterSelect}if(e.options.readonly==false){a("#"+c+" .text_box").css("background-color","white")}else{a("#"+c+" .text_box").css("background-color","#EEEEEE")}e.keyToSearch();e.mouseToCollapse();e.clickOtherToHideTable()},loader:function(g){var d=this;var l=a('div[for="'+d.ID+'"]');l.find(".data_panel tr").remove();if(!g){g={page:1,rows:d.options.pageSize}}if(!a.isEmptyObject(d.setparam)){for(var j in d.setparam){g[j]=d.setparam[j]}}if(d.paramFn!=null){var e=d.paramFn();for(var h in e[0]){g[h]=e[0][h]}if(e[1]){d.options.idField=e[1][0];d.options.textField=e[1][1];d.options.columns=[{title:"名称",field:e[1][1]},]}}var f="";for(var h in g){f+=h+"="+g[h]+"&"}var c=d.options.url+"?"+f;var k=window.sessionStorage.getItem(c);if(k&&d.options.isCache){d.setData(k,g)}else{a.ajax({type:d.options.method,url:d.options.url,async:false,data:g,cache:false,success:function(m){var i=this.url+"?"+this.data+"&";window.sessionStorage[i]=m;d.setData(m,g)},error:function(){}})}},setData:function(m,p){if(typeof(m)!="object"){m=JSON.parse(m)}var d=this;var c=d.ID;var l=d.options.columns[0].field;var q=d.options.idField;var e=d.options.textField;var r=a('div[for="'+d.ID+'"]');for(var h=0;h<m.rows.length;h++){var n="";if(h%2!=0){n="evenBgColor"}if(d.options.multiSelect==true){var o="";for(var f=0;f<d.checkVal.length;f++){if(m.rows[h][q]==d.checkVal[f]){var o="checked"}}r.find(".data_table table").append("<tr index="+m.rows[h][q]+' class="'+n+'"><td>'+(h+1)+"</td><td><input "+o+' type="checkbox" value="'+m.rows[h][q]+'" text="'+m.rows[h][e]+'"></td><td title="'+m.rows[h][l]+'">'+m.rows[h][l]+"</td></tr>")}else{r.find(".data_table table").append("<tr index="+m.rows[h][q]+' class="'+n+'"><td>'+(h+1)+'</td><td title="'+m.rows[h][l]+'">'+m.rows[h][l]+"</td></tr>")}}for(var g=1;g<d.options.columns.length;g++){l=d.options.columns[g].field;for(var h=0;h<m.rows.length;h++){r.find(".data_table table tr:eq("+h+")").append('<td title="'+m.rows[h][l]+'">'+m.rows[h][l]+"</td>")}}d.setPage({page:m.page,allPage:m.totalpage,total:m.total},p);d.mouseToSelect(m);if(!d.options.multiSelect){d.keyToSelect(m)}if(!d.options.isWrite){if(m.rows.length==0){a("#"+c+" .input_text").val(" ");d.checkVal=[];d.checkText=[]}}},setPage:function(f,e){var g=this;var h=g.ID;var c=a('div[for="'+g.ID+'"]');c.find(".combogrid_page").html("");var d='<span class="pagination_nav"><span class="pagination_bgimg"></span><span class="pagination_bgimg pagination_bgimg_pos1"></span><span class="nowPage">'+f.page+"</span>/<span>"+f.allPage+'</span><span class="canClick pagination_bgimg pagination_bgimg_pos2"></span><span class="canClick pagination_bgimg pagination_bgimg_pos3"></span></span>';c.find(".combogrid_page").append(d);c.find(".combogrid_page .pagination_nav span:eq(4)").click(function(i){g.next(e,f)});c.find(".combogrid_page .pagination_nav span:eq(1)").click(function(i){g.prev(e)});c.find(".combogrid_page .pagination_nav span:eq(5)").click(function(i){g.last(e,f)});c.find(".combogrid_page .pagination_nav span:eq(0)").click(function(i){g.first(e)});c.find(".combogrid_page").bind("click",function(i){i=i||window.event;i.stopPropagation()})},prev:function(d){var g=this;var i=g.ID;var c=a('div[for="'+g.ID+'"]');if(parseInt(d.page)>1){var f=parseInt(d.page)-1;var h=g.options.textField;var e={page:f,rows:g.options.pageSize};if(d[h]){e[h]=d[h]}g.loader(e)}if(parseInt(d.page)<=1){c.find('.combogrid_page .pagination_nav span:eq(0),div[for="'+g.ID+'"].combogrid_page  .pagination_nav span:eq(1)').removeClass("canClick")}else{c.find('.combogrid_page  .pagination_nav span:eq(0),div[for="'+g.ID+'"].combogrid_page  .pagination_nav span:eq(1)').addClass("canClick")}c.find('.combogrid_page  .pagination_nav span:eq(4),div[for="'+g.ID+'"].combogrid_page  .pagination_nav span:eq(5)').addClass("canClick")},next:function(e,d){var h=this;var k=h.ID;var c=a('div[for="'+h.ID+'"]');if(parseInt(e.page)<d.allPage){var g=parseInt(e.page)+1;var j=h.options.textField;var f={page:g,rows:h.options.pageSize};if(e[j]){f[j]=e[j]}h.loader(f)}if(e.page>=d.allPage){c.find('.combogrid_page  .pagination_nav span:eq(4),div[for="'+h.ID+'"].combogrid_page  .pagination_nav span:eq(5)').removeClass("canClick")}c.find('.combogrid_page  .pagination_nav span:eq(0),div[for="'+h.ID+'"].combogrid_page  .pagination_nav span:eq(1)').addClass("canClick")},first:function(d){var g=this;var i=g.ID;var f=1;var h=g.options.textField;var e={page:f,rows:g.options.pageSize};var c=a('div[for="'+g.ID+'"]');if(d[h]){e[h]=d[h]}g.loader(e);c.find('.combogrid_page  .pagination_nav span:eq(0),div[for="'+g.ID+'"].combogrid_page  .pagination_nav span:eq(1)').removeClass("canClick");c.find('.combogrid_page  .pagination_nav span:eq(4),div[for="'+g.ID+'"].combogrid_page  .pagination_nav span:eq(5)').addClass("canClick")},last:function(e,d){var h=this;var k=h.ID;var g=d.allPage;var j=h.options.textField;var f={page:g,rows:h.options.pageSize};var c=a('div[for="'+h.ID+'"]');if(e[j]){f[j]=e[j]}h.loader(f);c.find('.combogrid_page  .pagination_nav span:eq(0),[for="'+h.ID+'"].combogrid_page  .pagination_nav span:eq(1)').addClass("canClick")},highLight:function(c){var d=this;var e=d.ID;a('div[for="'+d.ID+'"] .data_panel .high_light').removeClass("high_light");c.addClass("high_light")},selectRow:function(j){var h=this;var k=h.ID;var c=a('div[for="'+h.ID+'"]');if(c.find(".data_panel .high_light").length>0){for(var f=0;f<j.rows.length;f++){if(j.rows[f][h.options.idField]==c.find(".data_panel .high_light").attr("index")||j.rows[f][h.options.idField]==c.find(".data_panel .select_light").attr("index")){if(h.options.multiSelect==false){a("#"+k+" input[type=text]").val(j.rows[f][h.options.textField]);a("#"+k+" input[type=hidden]").attr("value",j.rows[f][h.options.idField])}}}if(h.afterFn!=null&&!h.options.multiSelect){h.afterFn([a("#"+k+" input[type=hidden]").val(),a("#"+k+" input[type=text]").val()])}if(h.options.ifEditGrid==true){var g=a("#"+h.ID).closest("tr");var e=a("#"+h.ID).closest("form").attr("id");var d=e.substring(0,e.length-5);if(g.hasClass("editing")){a("#"+d).EditableGrid("saveValue","editing")}else{a("#"+d).EditableGrid("saveValue","adding")}}}},mouseToSelect:function(e){var d=this;var f=d.ID;var c=a('div[for="'+d.ID+'"]');c.find(".data_panel tr").on("mouseover","td",function(g){d.highLight(a(this).parent())});if(!d.options.multiSelect){c.find(".data_panel tr").on("mousedown","td",function(g){d.selectRow(e);d.collapseTable()})}else{c.find(".data_panel tr").bind("click",function(m){var m=m||window.event;var j=a(this).find(":checkbox");if(j.is(":checked")){for(var k=0;k<d.checkVal.length;k++){if(d.checkVal[k]==j.attr("value")){d.checkVal.splice(k,1)}if(d.checkText[k]==j.attr("text")){d.checkText.splice(k,1)}}j.prop("checked",false)}else{d.checkVal.push(j.attr("value"));d.checkText.push(j.attr("text"));j.prop("checked",true)}if(d.options.showText==true){var n=d.checkText.join(",");a("#"+f+" .input_text").val(n)}a("#"+f+" input[type=hidden]").attr("value",d.checkVal.join(","));d.setValBox();m.stopPropagation();if(d.options.multiSelect&&d.options.afterSelect){d.options.afterSelect()}if(d.options.ifEditGrid==true){var l=a("#"+d.ID).closest("tr");var h=a("#"+d.ID).closest("form").attr("id");var g=h.substring(0,h.length-5);if(l.hasClass("editing")){a("#"+g).EditableGrid("saveValue","editing")}else{a("#"+g).EditableGrid("saveValue","adding")}}});c.find(":checkbox").bind("click",function(m){var m=m||window.event;var j=a(this);if(j.is(":checked")){d.checkVal.push(j.attr("value"));d.checkText.push(j.attr("text"));j.prop("checked",true)}else{for(var k=0;k<d.checkVal.length;k++){if(d.checkVal[k]==j.attr("value")){d.checkVal.splice(k,1)}if(d.checkText[k]==j.attr("text")){d.checkText.splice(k,1)}}j.prop("checked",false)}if(d.options.showText==true){var n=d.checkText.join(",");a("#"+f+" .input_text").val(n)}a("#"+f+" input[type=hidden]").attr("value",d.checkVal.join(","));d.setValBox();if(d.options.multiSelect&&d.options.afterSelect){d.options.afterSelect()}if(d.options.ifEditGrid==true){var l=a("#"+d.ID).closest("tr");var h=a("#"+d.ID).closest("form").attr("id");var g=h.substring(0,h.length-5);if(l.hasClass("editing")){a("#"+g).EditableGrid("saveValue","editing")}else{a("#"+g).EditableGrid("saveValue","adding")}}m.stopPropagation()})}},keyToSearch:function(){var d=this;var g=d.ID;var e="";var f=null;var c=a('div[for="'+d.ID+'"]');a("#"+g+" .input_text").bind("click",function(h){var h=h||window.event;d.collapseTable();if(c.hasClass("collapse_table")==false){var i={page:1,rows:d.options.pageSize};d.loader(i)}h.stopPropagation()});a("#"+g+" .input_text").bind("keyup click",function(h){clearTimeout(f);if(h.keyCode!=13&&h.keyCode!=38&&h.keyCode!=40){c.find(".data_panel").removeClass("collapse_table");c.find(".combogrid_page").removeClass("collapse_table");f=setTimeout(function(){e=a("#"+g+" .input_text").val();var j=d.options.textField;var i={page:1,rows:d.options.pageSize};i[j]=e;if(e==""){a("#"+g+" input[type=hidden]").val("")}d.loader(i);if(d.options.isWrite){if(a.trim(a("#"+g+" input[type=hidden]").val())==""){a("#"+g+" input[type=hidden]").val(a("#"+g+" .input_text").val())}}if(d.options.isWrite&&d.compareFn){d.compareFn(a("#"+g+" input[type=hidden]").val())}},800)}})},keyToSelect:function(f){var e=this;var g=e.ID;var c=a('div[for="'+e.ID+'"]');var d=0;a("#"+g+',[for="'+e.ID+'"] .data_panel').unbind("keydown");a("#"+g+',[for="'+e.ID+'"] .data_panel').bind("keydown",function(i){var i=window.event||i;if(i.keyCode==13){e.selectRow(f);e.collapseTable();return false}else{if(i.keyCode==38){d=c.find(".data_panel .high_light").index()-1;var h=d%c.find(".data_panel tr").length;e.highLight(c.find(".data_panel tr:eq("+h+")"))}else{if(i.keyCode==40){d=c.find(".data_panel .high_light").index()+1;var h=d%c.find(".data_panel tr").length;e.highLight(c.find(".data_panel tr:eq("+h+")"))}}}})},getValue:function(){var c=this;var e=c.ID;var d=a("#"+e+" input[type=hidden]").val();return d},mouseToCollapse:function(){var d=this;var e=d.ID;var c=a('div[for="'+d.ID+'"]');if(d.options.icon==true){a("#"+e+" .tocollapse").bind("click",function(f){var f=f||window.event;d.collapseTable();if(c.find(".data_panel").hasClass("collapse_table")==false){d.loader()}f.stopPropagation()})}},collapseTable:function(){var d=this;var g=d.ID;var c=a('div[for="'+d.ID+'"]');var f=a("#"+g).offset().top+30;var e=a("#"+g).offset().left;c.css({top:f,left:e});a("div.table_wrap").not('[for="'+d.ID+'"]').addClass("collapse_table");a("ul.item_list").addClass("item_display");if(d.options.readonly==false){c.toggleClass("collapse_table")}},clickOtherToHideTable:function(){var d=this;var e=d.ID;var c=a('div[for="'+d.ID+'"]');a("body").bind("click",function(){c.addClass("collapse_table")})},setAllValue:function(c){var d=this;var e=d.ID;a("#"+e+" input[type=hidden]").val(c[0]);a("#"+e+" .input_text").val(c[1]);if(d.options.multiSelect==true){d.checkVal=c[0].split(",");d.checkText=c[1].split(",")}},setValue:function(g){var q=this;var l=q.ID;var m=g;var u={page:1};if(a("#"+l+" input[type=hidden]").attr("value")!=""&&a("#"+l+" input[type=hidden]").attr("value")!=b){m=a("#"+l+" input[type=hidden]").attr("value");u[q.options.idField]=m;if(q.options.multiSelect==true){q.checkVal=q.checkVal.concat(m.split(","))}}else{if(g!=""&&g!=b&&g!=null){a("#"+l+" input[type=hidden]").attr("value",g)}else{return false}}var e="";for(var o in u){e+=o+"="+u[o]+"&"}var d=q.options.url+"?"+e;var t=window.sessionStorage.getItem(d);var w="";if(t&&q.options.isCache){t=JSON.parse(t);if(q.options.multiSelect==true){for(var r=0;r<t.rows.length;r++){for(var p=0;p<q.checkVal.length;p++){if(t.rows[r][q.options.idField]==q.checkVal[p]){q.checkText.push(t.rows[r][q.options.textField]);w+=","+t.rows[r][q.options.textField]}}}a("#"+l+" .input_text").val(w)}else{for(var r=0;r<t.rows.length;r++){if(t.rows[r][q.options.idField]==m){a("#"+l+" .input_text").val(t.rows[r][q.options.textField])}}}}else{var f=q.options.url;var c=q.options.idField;var s=f;if(f.indexOf(c)>0){var h=f.substring(f.indexOf(c));var n=h.split("&")[0];var k=n.split("=")[1];s=q.options.url.replace(k,g)}else{s=q.options.url+"&"+q.options.idField+"="+g}a.ajax({type:q.options.method,url:s,async:false,data:u,cache:false,success:function(z){if(typeof(z)!="object"){z=JSON.parse(z)}if(q.options.multiSelect==true){for(var y=0;y<z.rows.length;y++){for(var v=0;v<q.checkVal.length;v++){if(z.rows[y][q.options.idField]==q.checkVal[v]){q.checkText.push(z.rows[y][q.options.textField]);w+=","+z.rows[y][q.options.textField]}}}a("#"+l+" .input_text").val(w)}else{for(var y=0;y<z.rows.length;y++){if(z.rows[y][q.options.idField]==m){a("#"+l+" .input_text").val(z.rows[y][q.options.textField])}}}var x=this.url+"?"+this.data+"&";var A=JSON.stringify(z);window.sessionStorage[x]=A},error:function(){}})}if(a.trim(m)==""){a("#"+l+" input[type=hidden]").attr("value","");a("#"+l+" .input_text").val("")}},setParam:function(c){this.setparam=c},beforeSelect:function(c){this.paramFn=c},afterSelect:function(c){this.afterFn=c},toCompare:function(c){this.compareFn=c},setReadOnly:function(d){var e=this;var f=e.ID;var c=a('div[for="'+e.ID+'"]');if(d==true){a("#"+f+" .input_text").prop("disabled","disabled");a("#"+f+" .text_box").css("background-color","#EEEEEE");c.find(".data_panel").css("display","none");c.find(".combogrid_page").css("display","none");e.options.readonly=true}else{a("#"+f+" .input_text").removeAttr("disabled");a("#"+f+" .text_box").css("background-color","white");c.find(".data_panel").css("display","");c.find(".combogrid_page").css("display","");e.options.readonly=false}},setCheck:function(h){var f=this;var i=f.element.context.id;a("#"+i).attr("check",h);a("#"+f.ID+" input.input_text").attr("check",h);a("#"+f.ID).find("span.tips").remove();var d=a("#"+f.ID+" input[type=hidden]").attr("check");var g=d.split(",");var c=[];for(var e=0;e<g.length;e++){c=g[e].split(":");if(c[0]=="required"){a("#"+f.ID).prepend('<span class="tips">*</span>')}}a("#"+f.ID+" span.tips").parent("div").css("outline","none")},selectCheckbox:function(){var c=this;var d=c.ID;return c.checkVal},setCheckboxVal:function(c){var d=this;var e=d.ID;d.checkVal=d.checkVal.concat(c);a.ajax({type:d.options.method,url:d.options.url,cache:false,success:function(k){k=JSON.parse(k);for(var h=0;h<k.rows.length;h++){for(var f=0;f<c.length;f++){if(k.rows[h][d.options.idField]==c[f]){d.checkText.push(k.rows[h][d.options.textField])}}}var g=this.url+"?"+this.data+"&";var l=JSON.stringify(k);window.sessionStorage[g]=l;d.setValBox()},error:function(){}})},setValBox:function(){var d=this;var e=d.element.context.id;a("div[boxFor="+e+"] table").html(" ");for(var c=0;c<d.checkText.length;c++){a("div[boxFor="+e+"] table").append("<tr><td>&nbsp&nbsp"+d.checkText[c]+"</td></tr>")}d.delCheckVal()},delCheckVal:function(){var c=this;var d=c.element.context.id;a("div[boxFor="+d+"] table .glyphicon-remove-circle").each(function(){var e=this;a(this).bind("click",function(){for(var f=0;f<c.checkVal.length;f++){if(c.checkVal[f]==a(this).attr("index")){c.checkVal.splice(f,1)}if(c.checkText[f]==a(this).attr("text")){c.checkText.splice(f,1)}}a(e).parent().parent().remove()})})},destroy:function(){a.Widget.prototype.destroy.call(this)}})})(jQuery);(function(a,b){a.widget("RUI.RGrid",{options:{dataUrl:null,colNames:null,colModel:null,width:null,height:null,onRowDbClick:null,afterRowInsert:null,isDefine:null,multiSelect:true,sumFieldColumn:null,rownumWidth:"25",method:"POST",baseParams:{}},_create:function(){var m=this;var o=m.element.attr("id");var g=m.options;var h=g.onRowDbClick;var v=g.afterRowInsert;var f=a(window).height();var r=76;var j=[];if(g.height){f=g.height}else{if(a(".operation_block").length!=0){f="auto"}else{if(f<=0){f=a(window.parent.document).find("iframe").css("height")}if(a(".grid_operate").length!=0){r+=49}f-=(r+10);j=[50,100,200,300]}}var s=a(window).width()-g.width;var t="#"+o;var d="#"+o+"-grid-pager";var k=a(t).closest('[class*="col-"]');a(window).on("resize.jqGrid",function(){a(t).jqGrid("setGridWidth",k.width())});a(window).bind("resize",function(){var i=a(window).height();var w=76;if(g.height){i=g.height}else{if(a(".operation_block").length!=0){i=null}else{if(i<=0){i=a(window.parent.document).find("iframe").css("height")}if(a(".grid_operate").length!=0){w+=49}i-=(w+10)}}a(t).jqGrid("setGridHeight",i)});a(document).on("settings.ace.jqGrid",function(i,w,x){if(w==="sidebar_collapsed"||w==="main_container_fixed"){setTimeout(function(){a(t).jqGrid("setGridWidth",k.width())},0)}});var u=false;var e=g.colModel.length;for(var q=0;q<g.colModel.length;q++){if(g.colModel[q].hidden==true){e--}}if(e<8){u=true}if(g.isDefine){var n=function(i,w,x){var y=" ";if(i=="true"){y='<a class="operate" src="javascript:;" style=" text-decoration: underline !important;cursor: pointer;" index="'+w.rowId+'">'+g.isDefine[1]+"</a>"}else{y='<button index="'+w.rowId+'">'+g.isDefine[1]+"</button>"}return y};g.colNames.push("操作");g.colModel.push({name:"visible",formatter:n,sortable:false})}var c;jQuery(t).jqGrid({url:g.dataUrl,datatype:"json",height:f,autowidth:true,colNames:g.colNames,colModel:g.colModel,rownumbers:true,rownumWidth:g.rownumWidth,viewrecords:true,mtype:g.method,shrinkToFit:u,rowNum:50,rowList:j,jsonReader:{root:"rows",page:"page",total:"totalpage",records:"total",repeatitems:false,id:"0"},postData:g.baseParams,pager:d,loadtext:"数据加载中，请稍候...",altRows:true,multiselect:g.multiSelect,multiboxonly:true,ondblClickRow:function(w,z,i,y){var x=a(t).jqGrid("getRowData",w);h&&h(w,x)},loadComplete:function(w){var i=this;setTimeout(function(){l(i);p(i)},0);if(a.trim(g.sumFieldColumn).length>0){a(".search_wrap .total[id="+g.sumFieldColumn+"]").show();a(".search_wrap .total[id="+g.sumFieldColumn+"] span").eq(0).html(w.total);a(".search_wrap .total[id="+g.sumFieldColumn+"] span").eq(1).html(w.sumFieldColumn)}},gridComplete:function(){jQuery(t).find("a.operate,button").each(function(){a(this).click(function(){var i=a(this).attr("index");var w=jQuery(t).jqGrid("getRowData",i);g.isDefine[0](w)})})},afterInsertRow:function(w,i){v&&v(w,i)}});a(window).triggerHandler("resize.jqGrid");function l(w){var i={"ui-icon-seek-first":"ace-icon fa fa-angle-double-left bigger-140","ui-icon-seek-prev":"ace-icon fa fa-angle-left bigger-140","ui-icon-seek-next":"ace-icon fa fa-angle-right bigger-140","ui-icon-seek-end":"ace-icon fa fa-angle-double-right bigger-140"};a(".ui-pg-table:not(.navtable) > tbody > tr > .ui-pg-button > .ui-icon").each(function(){var y=a(this);var x=a.trim(y.attr("class").replace("ui-icon",""));if(x in i){y.attr("class","ui-icon "+i[x])}})}function p(i){a(".navtable .ui-pg-button").tooltip({container:"body"});a(i).find(".ui-pg-div").tooltip({container:"body"})}a(document).one("ajaxloadstart.page",function(i){a(t).jqGrid("GridUnload");a(".ui-jqdialog").remove()})},_bindEvent:function(){var c=this},setGridParam:function(c){var d=this.element.attr("id");jQuery("#"+d).setGridParam({postData:c,page:1}).trigger("reloadGrid")},getSelectedDatas:function(){var g=this.element.attr("id");var f=jQuery("#"+g).getGridParam("selarrrow");var e=new Array();for(var c=0;c<f.length;c++){var d=jQuery("#"+g).getRowData(f[c]);e.push(d)}return e},getAllData:function(){var c=this.element.attr("id");return jQuery("#"+c).getRowData()},setValue:function(c){var d=this},destroy:function(){a.Widget.prototype.destroy.call(this)}})})(jQuery);(function(a,b){a.widget("RUI.RButton",{options:{onClick:null,isShow:true},_create:function(){var c=this;c._bindEvent()},_init:function(){var c=this;var d=c.element.context.id;if(c.options.isShow==false){a("#"+d).hide()}},_bindEvent:function(){var c=this;c.element.click(function(d){c.click()})},click:function(d){var c=this;var f=c.options;if(a.isFunction(f.onClick)){f.onClick.call(c)}},setText:function(d){var c=this;var e=c.element.context.id;a("#"+e+" span").html(d)},setInvisible:function(d){var c=this;var e=c.element.context.id;a("#"+e).removeAttr("visible");if(d){a("#"+e).hide()}else{a("#"+e).show()}},destroy:function(){a.Widget.prototype.destroy.call(this)}})})(jQuery);(function(a,b){a.widget("RUI.RWin",{options:{height:null,width:null,maxable:false,onClose:true,hasCloseBtn:true},_create:function(){var c=this},createWin:function(c){var f=this;var d="#"+f.element.attr("id");var e=f.options.width;var k=f.options.height;var g=f.options.maxable;var i=f.options.onClose;var j=f.options.hasCloseBtn;var h="#iframe-"+f.element.attr("id");a(d).on("show.bs.modal",function(n){var q=a(this).find("iframe");var m=k,s=e,r,l,p,o;m=a(window).height();s=window.innerWidth||document.documentElement.clientWidth;q.removeAttr("height");q.removeAttr("src");if(j==false){a(this).find("button").hide()}if(g==true){r=s;l=m;p=0;o=0;q.css({height:l-30})}else{r=e;l=k;p=(m-k)/2;o=(s-e)/2;q.css({height:(l-30)+"px"})}a(this).children(".modal-dialog").css({position:"absolute",width:r,height:l,top:p,left:o,margin:"0"});a(d).on("shown.bs.modal",function(t){a(h).attr("src",c)});a(this).find(".modal-content").css({width:r,height:l,});a(this).find(".modal-body").css({height:(l-30)})});a(window).resize(function(){var m=k,q=e,p,l,o,n;m=a(window).height();q=window.innerWidth||document.documentElement.clientWidth;if(j==false){a(this).find("button").hide()}if(g==true){p=q;l=m;o=0;n=0}else{p=e;l=k;o=(m-k)/2;n=(q-e)/2}a(d).children(".modal-dialog").css({top:o,left:n,})});a(d).modal("show")},_bindEvent:function(){var c=this},setPageUrl:function(c){var d=this},destroy:function(){a.Widget.prototype.destroy.call(this)}})})(jQuery);(function(a,b){a.widget("RUI.RCalendar",{options:{skin:"twoer",dateFmt:"",errDealMode:1,showTips:false,staticShow:false,afterSelect:null,readonly:false},_init:function(){var f=this;var i=f.element.context.id;if(f.options.staticShow){f.options.eCont=i;if(f.options.afterSelect){f.options.onpicked=f.options.afterSelect;WdatePicker(f.options)}}else{a("#"+i).wrap('<div id="'+i+'_wrap"></div>');a("#"+i+"_wrap").css("position","relative");if(f.options.showTips==true){var d=a("#"+i).attr("check");var g=d.split(",");var c=[];for(var e=0;e<g.length;e++){c=g[e].split(",");if(c[0]=="required"){a("#"+i+"_wrap").prepend('<span class="tips">*</span>')}}}var h;a("#"+i).click(function(){WdatePicker(f.options)})}},setValidDates:function(d){var c=this;var e=c.element.context.id;c.options=a.extend(true,c.options,d)},afterSelect:function(c){var d=this;var f=d.element.context.id;var e={onpicked:c};d.options=a.extend(true,d.options,e)},_create:function(){var c=this;var d=c.element.context.id;if(c.options.readonly==true){a("#"+d).attr("readonly","readonly");a("#"+d).css("background-color","#EEEEEE");a("#"+d).attr("disabled","disabled")}}})})(jQuery);(function(a,b){a.widget("RUI.RNumberField",{options:{numFmt:"",showTips:false,readonly:false},_init:function(){},_create:function(){var h=this;var d=h.element.context.id;var j=null;if(h.options.showTips==true){a("#"+d).wrap('<div  id="'+d+'_wrap" style="position:relative"></div>');var e=a("#"+d).attr("check");var i=e.split(",");var c=[];for(var f=0;f<i.length;f++){c=i[f].split(":");if(c[0]=="required"){a("#"+d+"_wrap").prepend('<span style="position: absolute;left: -8px;top: 8px;color: red;">*</span>')}}}var g="";if(h.options.numFmt=="int"){a("#"+d).attr("placeholder","请填写整数");a("#"+d).bind("keyup",function(){g=/^-?\d*$/;if(g.test(a("#"+d).val())==false){var k=a("#"+d).val();a("#"+d).val(k.substring(0,k.length-1))}})}else{a("#"+d).attr("placeholder","小数点保留至两位");if(h.options.numFmt=="money"){a("#"+d).attr("isMoney","true");a("#"+d).attr("type","text")}a("#"+d).bind("keyup",function(){g=/^\d+(\.+\d{1,2})?$/;if(g.test(a("#"+d).val())==false){var k=a("#"+d).val().split("");var l="";for(var m=0;m<k.length;m++){if(k[m]!=="."){l+=k[m]}else{l+=k[m];l+=k[m+1]||"";l+=k[m+2]||"";break}}a("#"+d).val(l)}})}if(h.options.readonly==true){a("#"+d).attr("readonly","readonly");a("#"+d).css("background-color","#EEEEEE")}h.cancelLongPress(a("#"+d))},cancelLongPress:function(d){var c=false;d.bind("keypress",function(f){if(c){f.preventDefault()}else{c=true}});d.bind("keyup",function(f){c=false})}})})(jQuery);(function(a,b){a.widget("RUI.RTextArea",{options:{selectable:true,viewtype:2,showTips:false,readonly:false},_create:function(){var f=this;var h=f.element.context.id;if(f.options.showTips==true){a("#"+h).wrap('<div id="'+h+'_wrap" style="position:relative"></div>');var d=a("#"+h).attr("check");var g=d.split(",");var c=[];for(var e=0;e<g.length;e++){c=g[e].split(":");if(c[0]=="required"){a("#"+h+"_wrap").prepend('<span style="position: absolute;left: -8px;top: 8px;color: red;">*</span>')}}}if(f.options.readonly==true){a("#"+h).css("background-color","#EEEEEE")}},_bindEvent:function(){var c=this},setValue:function(c){var d=this},destroy:function(){a.Widget.prototype.destroy.call(this)}})})(jQuery);(function(a,b){a.widget("RUI.RTextField",{options:{selectable:true,viewtype:2,showTips:false,readonly:false,afterInput:null},ID:"",_create:function(){var f=this;var h=f.element.context.id;f.ID=h+"_wrap";if(f.options.readonly==true){a("#"+h).attr("readonly","readonly");a("#"+h).css("background-color","#EEEEEE");a("#"+h).prop("placeholder","")}if(f.options.showTips==true){a("#"+h).wrap('<div id="'+h+'_wrap" style="position:relative"></div>');var d=a("#"+h).attr("check");var g=d.split(",");var c=[];for(var e=0;e<g.length;e++){c=g[e].split(":");if(c[0]=="required"){a("#"+h+"_wrap").prepend('<span class="tips">*</span>')}}}if(f.options.afterInput){a("#"+h).bind("blur",function(){f.options.afterInput(a("#"+h).val())})}},setCheck:function(h){var f=this;var i=f.element.context.id;a("#"+i).attr("check",h);a("#"+f.ID).find("span.tips").remove();var d=a("#"+i).attr("check");var g=d.split(",");var c=[];for(var e=0;e<g.length;e++){c=g[e].split(":");if(c[0]=="required"){a("#"+f.ID).prepend('<span class="tips">*</span>')}}a("#"+f.ID+" span.tips").parent("div").css("outline","none")},_bindEvent:function(){var c=this},setValue:function(c){var d=this},setReadOnly:function(d){var c=this;var e=c.element.context.id;if(!d){a("#"+e).removeAttr("readonly");a("#"+e).css("backgroundColor","white")}else{a("#"+e).attr("readonly","readonly");a("#"+e).css("backgroundColor","#EEEEEE")}},destroy:function(){a.Widget.prototype.destroy.call(this)}})})(jQuery);(function(a,b){a.widget("RUI.RTree",{options:{dataUrl:"",selectModel:false,onNodeClick:null},treeData:null,_create:function(){var c=this;c.getData()},getData:function(){var c=this;a.ajax({url:c.options.dataUrl,type:"post",dataType:"json",async:false,success:function(d){c.setTree(d)},error:function(){}})},setTree:function(f){var e=this;var h=e.element.context.id;a("#"+h).html(" ");f=f.data;e.treeData=f;for(var d=0;d<f.length;d++){var c="";if(f[d].children){c='<li id="tree_'+f[d].id+'" ifParent="true" class="tree-branch"><div class="tree-branch-header"><i class="tree-toggle fa fa-plus-square-o"></i><span class="tree-branch-title"><i class="tree-chk fa fa-square-o" haschecked="'+f[d].checked+'"></i><span class="tree-branch-name">'+f[d].name+"</span></span></div></li>";a("#"+h).append(c);g(f[d])}else{c='<li id="tree_'+f[d].id+'" class="tree-branch"><div class="tree-branch-header"><span class="tree-branch-title"><i class="tree-chk fa fa-square-o" haschecked="'+f[d].checked+'"></i><span class="tree-branch-name">'+f[d].name+"</span></span></div></li>";a("#"+h).append(c)}}function g(l){var i=' <ul id="child_'+l.id+'"  class="tree-branch-children"></ul>';a("#"+h+" #tree_"+l.id).append(i);if(l.children){for(var k=0;k<l.children.length;k++){if(l.children[k].children){i='<li id="tree_'+l.children[k].id+'" ifParent="true"  class="tree-branch"><div class="tree-branch-header"><i class="tree-toggle fa fa-plus-square-o" ></i><span class="tree-branch-title"><i class="tree-chk fa fa-square-o" haschecked="'+l.children[k].checked+'"></i><span class="tree-branch-name">'+l.children[k].name+"</span></span></div></li>";a("#"+h+" #child_"+l.id).append(i);g(l.children[k])}else{i='<li id="tree_'+l.children[k].id+'" class="tree-branch"><div class="tree-branch-header"><span class="tree-branch-title"><i class="tree-chk fa fa-square-o" haschecked="'+l.children[k].checked+'"></i><span class="tree-branch-name">'+l.children[k].name+"</span></span></div></li>";a("#"+h+" #child_"+l.id).append(i)}}}}e.toggleTree();if(e.options.selectModel){e.toggleCheckBox();e.setCheck()}else{a("#"+h).find("i.tree-chk").remove();e.toMarkNode()}if(e.options.onNodeClick){a("#"+h+" span.tree-branch-name").each(function(){var i=a(this).closest("li").attr("id").substring(5);a(this).bind("click",function(){e.options.onNodeClick(i)})})}},toggleTree:function(){var c=this;var d=c.element.context.id;a("#"+d+" [ifParent=true]").children(".tree-branch-header").children("i").bind("click",function(){if(!a(this).attr("ifShow")||a(this).attr("ifShow")=="false"){a(this).parent().siblings("ul").show();a(this).attr("ifShow",true);a(this).removeClass("fa-plus-square-o").addClass("fa-minus-square-o")}else{a(this).parent().parent().find("ul").hide();a(this).parent().parent().find("[ifShow=true]").removeClass("fa-minus-square-o").addClass("fa-plus-square-o");a(this).parent().parent().find("[ifShow=true]").attr("ifShow",false);a(this).attr("ifShow",false)}})},toggleCheckBox:function(){var c=this;var d=c.element.context.id;a("#"+d+" .tree-chk").bind("click",function(){if(a(this).hasClass("fa-square-o")){a(this).removeClass("fa-square-o").addClass("fa-check-square fa-check-y");a(this).parent().parent().siblings("ul").find(".tree-chk").removeClass("fa-square-o fa-check-n").addClass("fa-check-square fa-check-y");a(this).parent().parent().parent().attr("state","all-checked");a(this).parent().parent().siblings("ul").find("li").attr("state","all-checked");c.findchecked(a(this).parent().parent().parent(),true)}else{a(this).removeClass("fa-check-square fa-check-y").addClass("fa-square-o");a(this).parent().parent().siblings("ul").find(".tree-chk").addClass("fa-square-o").removeClass("fa-check-square fa-check-y fa-check-n");a(this).parent().parent().parent().attr("state","no-checked");a(this).parent().parent().siblings("ul").find("li").attr("state","no-checked");c.findchecked(a(this).parent().parent().parent(),false)}})},setCheck:function(){var d=this;var e=d.element.context.id;a("#"+e).find(".tree-chk").each(function(){if(a(this).attr("haschecked")=="true"){if(a(this).parent().parent().parent().attr("ifparent")!="true"){a(this).addClass("fa-check-square fa-check-y").removeClass("fa-square-o");a(this).parent().parent().parent("li").attr({state:"all-checked"})}}});a("#"+e+' [state="all-checked"]').each(function(){c(a(this))});function c(g){var f=g.closest("ul");if(f.children("li").length>f.children('li[state="all-checked"]').length){f.closest("li").attr("state","half-checked");f.closest("li").children("div").find("span i").removeClass("fa-square-o").addClass("fa-check-square fa-check-n")}else{f.closest("li").attr("state","all-checked");f.closest("li").children("div").find("span i").removeClass("fa-square-o").addClass("fa-check-square fa-check-y")}if(!f.hasClass("rtree")){c(f.closest("li"))}}},findchecked:function(i,f){var g=this;var e=i.siblings("li").length;var d=i.siblings('li[state="all-checked"]').length;var c=i.siblings('li[state="half-checked"]').length;var h=i.attr("state");if(f){if(e==d&&h=="all-checked"){i.parent().siblings("div").find(".tree-chk").removeClass("fa-square-o fa-check-n").addClass("fa-check-square fa-check-y");i.parent().parent().attr("state","all-checked")}else{i.parent().siblings("div").find(".tree-chk").removeClass("fa-square-o fa-check-y").addClass("fa-check-square fa-check-n");i.parent().parent().attr("state","half-checked")}if(i.parent().parent().length>0){g.findchecked(i.parent().parent(),true)}}else{if(d==0&&c==0&&h=="no-checked"){i.parent().siblings("div").find(".tree-chk").addClass("fa-square-o").removeClass("fa-check-square fa-check-y fa-check-n");i.parent().parent().attr("state","no-checked")}else{i.parent().siblings("div").find(".tree-chk").removeClass("fa-square-o fa-check-y").addClass("fa-check-square fa-check-n");i.parent().parent().attr("state","half-checked")}if(i.parent().parent().length>0){g.findchecked(i.parent().parent(),false)}}},toMarkNode:function(){var c=this;var d=c.element.context.id;a("#"+d+" span.tree-branch-name").bind("mousedown",function(){a("#"+d+" span.tree-branch-name").removeAttr("mark");a("#"+d+" .tree-branch-header").removeClass("tree_active");a(this).attr("mark","true");a(this).closest(".tree-branch-header").addClass("tree_active")})},expand:function(){var c=this;var d=c.element.context.id;a("#"+d+" .tree-toggle").removeClass("fa-plus-square-o").addClass("fa-minus-square-o");a("#"+d+" i.tree-toggle").attr("ifshow","true");a("#"+d+" .tree-branch-children").show()},close:function(){var c=this;var d=c.element.context.id;a("#"+d+" .tree-toggle").addClass("fa-plus-square-o").removeClass("fa-minus-square-o");a("#"+d+" i.tree-toggle").attr("ifshow","false");a("#"+d+" .tree-branch-children").hide()},refresh:function(){var c=this;c.getData()},getValue:function(){var h=this;var k=h.element.context.id;var c=[];var g=[];if(h.options.selectModel){a("#"+k).find('li[state="all-checked"],li[state="half-checked"]').each(function(){var i=a(this).attr("id").substring(5);g.push(i)});var d=h.viewjsondata(h.treeData);for(var f=0;f<g.length;f++){for(var e=0;e<d.length;e++){if(d[e].id==g[f]){c.push(d[e])}}}}else{if(a("#"+k).find('[mark="true"]').length>0){var l=a("#"+k).find('[mark="true"]').closest("li").attr("id").substring(5);c.push(l)}}return c},getName:function(){var e=this;var f=e.element.context.id;var c=[];if(e.options.selectModel){a("#"+f).find('li[state="all-checked"],li[state="half-checked"]').each(function(){var g=a(this).children("div").find("span.tree-branch-name").html();c.push(g)})}else{var d=a("#"+f).find('[mark="true"]').html();c.push(d)}return c},viewjsondata:function(f){var c=[];var h=this;for(var e=0,d=f.length;e<d;e++){var g={};a.extend(g,{id:f[e]["id"],pid:f[e]["pid"],name:f[e]["name"],leaf:f[e]["leaf"]});c.push(g);if(f[e]["children"]&&f[e]["children"].length>0){a.merge(c,h.viewjsondata(f[e]["children"]))}}return c}})})(jQuery);(function(a,b){a.widget("RUI.RValidate",{options:{success:null,opt:null,scroll:false},_create:function(){var c=this},_init:function(){},validate:function(){var d=this;var c=d.element.context.id;var e="for"+c;a("."+e).remove();a("#"+c+" .promptinput").removeClass("promptinput");this.checkInput();this.checkSelect();this.checkTextarea();this.checkHidden();if(a(".promptbox").length==0){if(this.options.success){this.options.success(this.options.opt)}else{return true}}else{return false}},checkHidden:function(){var e=this;var d=a("#"+e.element.context.id);var c=d.find("input[type=hidden]");c.each(function(){var f=a(this).attr("check");var g=this;if(f=="required"){e.ifRequired(g)}})},checkInput:function(){var e=this;var c=a("#"+e.element.context.id);var d=c.find("input[type=text]");d.each(function(){var f=a(this).attr("check");var h=this;if(f!=""&&f!="undefined"&&f!=b){var g=f.split(",");a.each(g,function(j,l){var k=l.split(":");switch(k[0]){case"required":if(!e.ifRequired(h)){return false}case"maxlength":e.checkMax(h,k[1]);break;case"minlength":e.checkMin(h,k[1]);break;case"email":e.ifEmail(h);break;case"cellphone":e.ifCellphone(h);break;case"telephone":e.ifTelephone(h);break;default:}})}})},checkSelect:function(){var e=this;var d=a("#"+e.element.context.id);var c=d.find("select");c.each(function(){var f=a(this).attr("check");var g=this;if(f!=""&&f!=b&&f!="undefined"&&a(g).attr("name")){e.ifRequired(g)}})},checkTextarea:function(){var e=this;var d=a("#"+e.element.context.id);var c=d.find("textarea");c.each(function(){var f=a(this).attr("check");var h=this;if(f!=""&&f!=b){var g=f.split(",");a.each(g,function(j,l){var k=l.split(":");switch(k[0]){case"required":if(!e.ifRequired(h)){return false}case"maxlength":e.checkMax(h,k[1]);break;case"minlength":e.checkMin(h,k[1]);break;default:}})}})},ifEmail:function(c){var e=this;var f=a(c).val();var d=/^(\w-*\.*)+@(\w-?)+(\.\w{2,})+$/;if(!d.test(f)&&a.trim(f)){if(e.options.scroll==false){a(c).addClass("promptinput")}e.showPromptbox("不符合邮箱格式",a(c).offset().left,a(c).offset().top,a(c).width())}},ifCellphone:function(c){var e=this;var f=a(c).val();var d=/^1(3|4|5|7|8)\d{9}$/;if(!d.test(f)&&a.trim(f)){if(e.options.scroll==false){a(c).addClass("promptinput")}e.showPromptbox("不符合手机号码格式",a(c).offset().left,a(c).offset().top,a(c).width())}},ifTelephone:function(c){var e=this;var f=a(c).val();var d=/^0\d{2,3}-?\d{7,8}$/;if(!d.test(f)&&a.trim(f)){if(e.options.scroll==false){a(c).addClass("promptinput")}e.showPromptbox("不符合电话格式",a(c).offset().left,a(c).offset().top,a(c).width())}},ifRequired:function(d){var e=this;var g=a(d).val();var c=true;var f=a(d);if(d.className=="input_text"){f=a(d).parent("div")}if(a(d).attr("role")=="defaultText"){f=a(d).parent()}if(a(d).attr("type")=="hidden"){f=a(d).parent()}if(a(d).hasClass("hid_val")){f=a(d).parents("form").find("span.combo_text")}if(a(d).parent().parent().next().attr("boxfor")){var h=a(d).parent().prev().attr("id");g=a("#"+h+"-box").html();if(a.trim(g)==""||g==null){e.showPromptbox("不能为空",f.offset().left,f.offset().top,f.width());if(e.options.scroll==false){if(d.className=="textbox-value"){a(d).parent("span").addClass("promptinput")}else{if(a(d).hasClass("input_text")){a(d).parent("div").addClass("promptinput")}else{f.addClass("promptinput")}}}c=false}}else{if(d.nodeName=="SELECT"){var h=a(d).attr("id")+"_wrap";f=a("#"+h+" .combo_text");g=a("#"+h+" select").val()}if(a.trim(g)==""||g==null){console.log(a(d).parent().parent().next().attr("boxfor"));e.showPromptbox("不能为空",f.offset().left,f.offset().top,f.width());if(e.options.scroll==false){if(d.className=="textbox-value"){a(d).parent("span").addClass("promptinput")}else{if(a(d).hasClass("input_text")){a(d).parent("div").addClass("promptinput")}else{f.addClass("promptinput")}}}c=false}}return c},checkMax:function(d,c){var e=this;var f=a(d).val();if(a.trim(f).length>c){if(e.options.scroll==false){a(d).addClass("promptinput")}e.showPromptbox("不能长于"+c+"个字符",a(d).offset().left,a(d).offset().top,a(d).width())}},checkMin:function(d,c){var e=this;var f=a(d).val();if(a.trim(f).length<c&&a.trim(f).length!=""){if(e.options.scroll==false){a(d).addClass("promptinput")}e.showPromptbox("不能短于"+c+"个字符",a(d).offset().left,a(d).offset().top,a(d).width())}},destroy:function(){a.Widget.prototype.destroy.call(this)},showPromptbox:function(h,k,j,l){var c=this;var e=a("#"+c.element.context.id);var d="for"+c.element.context.id;if(c.options.scroll==true){var e=a("#"+c.element.context.id);var m=e.find(".tab_data");var g=m.offset().left;var f=m.offset().top;m.append(a('<span class="'+d+'"></span>').text(h).addClass("promptbox").fadeIn().css({position:"absolute",top:j-f+20+m.scrollTop(),left:k-g+l-60}))}else{a("body").append(a('<span class="'+d+'"></span>').text(h).addClass("promptbox").fadeIn().css({position:"absolute",top:j-20,left:k+l-65}))}}})})(jQuery);(function(a){a.RMessage={confirm:function(d,c,e,b){this.show({type:1,title:d,msg:c,confirmHandle:e,cancelHandle:b})},alert:function(d,c,e){var b=this;b.show({type:0,title:d,msg:c,confirmHandle:e})},show:function(f){var c="<button type='button' class='btn btn-primary' style='padding:2px 6px;' data-dismiss='modal' id='confirmBtn'>确定</button> 		                    <button type='button' class='btn btn-primary' style='padding:2px 6px;' data-dismiss='modal' id='cancelBtn'>取消</button>";var e="<button type='button' class='btn btn-primary' style='padding:2px 6px;' data-dismiss='modal' id='confirmBtn'>确定</button>";var d=f.type?c:e;if(a("body").find("#winModal").length<1){var b="		            <div class='modal fade bs-example-modal-lg' id='winModal' tabindex='-1' role='dialog' aria-labelledby='winModalLabel'> 		            <div class='modal-dialog modal-sm' role='document'> 		            <div class='modal-content'> 		            <div class='modal-header'> 		            <button type='button' class='close' data-dismiss='modal' aria-label='Close'><span aria-hidden='true'>&times;</span></button> 		            <h4 class='modal-title' id='winModalLabel'>消息</h4> 		            </div> 		            <div class='modal-body'> 		            <p id='winModalContent' style='font-size:15px;'>提示内容</p> 		            </div> 		             <div class='modal-footer' style='padding:5px;margin-right:5px;'> 		                  </div> 		            </div> 		            </div> 		            </div>";a("body").css("height",a(window).height()).append(b)}a("#winModal .modal-footer").empty();a("#winModal .modal-footer").append(d);a("#winModalLabel").text(f.title);a("#winModalContent").text(f.msg);if(a("#winModal .modal-backdrop").length>0){a("#winModal .modal-backdrop").remove()}a("#winModal").modal("show");a("#confirmBtn").unbind("click").click(function(g){if(a.isFunction(f.confirmHandle)){f.confirmHandle()}});a("#cancelBtn").unbind("click").click(function(g){if(a.isFunction(f.cancelHandle)){f.cancelHandle()}})}}})(jQuery);(function(a,b){a.widget("RUI.EditableGrid",{options:{dataUrl:"",columns:[],pageSize:3,initialize:null,height:null,hiddenCol:[],saveFn:null,primaryKey:[]},tabledata:null,delData:[],addItem:0,editData:[],addData:[],allpKey:[],tdWid:[],_create:function(){},_init:function(){var e=this;var c=e.element.context.id;e.delData=[];e.addData=[];e.editData=[];a("#"+c).wrap('<form id="'+c+'_form" class="editablegrid" onSubmit="return false"></form>');var d='<div class="tab_wrap"><div class="tab_title"><table cellpadding="0" cellspacing="0" style="position: relative;"><thead></thead></table></div>';d+='<div class="tab_data"><table cellpadding="0" cellspacing="0"></table></div></div>';d+='<div class="tab_page"></div>';a("#"+c).html(d);e.setHead();e.getData({rows:e.options.pageSize,page:"1"})},setHead:function(){var g=this;var c=g.element.context.id;var d=g.options;var f=a("<tr><th>操作</th></tr>");for(var e=0;e<d.columns.length;e++){f.append("<th>"+d.columns[e].title+"</th>")}a("#"+c+" .tab_title table thead").append(f)},setWidth:function(){var f=this;var c=f.element.context.id;var e=[];var g=0;a("#"+c+" .first_row td").each(function(){if(a(this).attr("width")==b){g+=parseInt(a(this).width())}else{g+=parseInt(a(this).attr("width"))}});a("#"+c+" .tab_data").children("table").width(g);a("#"+c+" .first_row td").each(function(){e.push(a(this).outerWidth())});for(var d=0;d<e.length;d++){a("#"+c+" .tab_title th").eq(d).outerWidth(e[d])}a("#"+c+" .tab_title table").width(a("#"+c+" .tab_data table").width());f.tdWid=e},setHeight:function(){var d=this;var c=d.element.context.id;a("#"+c).parents("body").css({height:"100%",width:"100%"});a("#"+c).parents("html").css({height:"100%",width:"100%"});if(d.options.height==null){a("#"+c).parent().css("height","100%");a("#"+c+" .tab_data").css("height",(a("#"+c).parent().height()-85))}else{a("#"+c+" .tab_data").css("height",d.options.height)}},headScroll:function(){var d=this;var c=d.element.context.id;a("#"+c+" .tab_data").scroll(function(){a("#"+c+" .tab_title").scrollLeft(a(this).scrollLeft())})},getData:function(d){var e=this;var c=e.options;a.ajax({url:c.dataUrl,type:"POST",async:false,cache:false,data:d,success:function(f){f=JSON.parse(f);e.tabledata=null;e.tabledata=f.rows;e.setBody(f);e.setPage([d.page,f.totalpage,f.total],f)},error:function(){alert("请求异常!")}})},setBody:function(h){var d=this;var n=d.element.context.id;var m=h.rows.length;var t=d.options.hiddenCol;var f;var s;if(m>0){a("span.promptbox").remove();a("#"+n+" .tab_data table").html("");d.allpKey=[];for(var l=0;l<m;l++){var p={};for(var e=0;e<t.length;e++){p[t[e]]=h.rows[l][t[e]]}d.allpKey.push(p);if(l==0){f=a('<tr  class="first_row"><td width="100"><span class="glyphicon glyphicon-edit edit_btn"></span><span class="glyphicon glyphicon-trash del_btn"></span></td></tr>')}else{f=a('<tr><td><span class="glyphicon glyphicon-edit edit_btn"></span><span class="glyphicon glyphicon-trash del_btn"></span></td></tr>');if(l%2!=0){f.addClass("row_col")}}for(var g=0;g<d.options.columns.length;g++){if(d.options.columns[g].type==4||d.options.columns[g].type==5||d.options.columns[g].type==0){var o=d.options.columns[g].id;var q=d.options.columns[g].text;s=a('<td  index="'+h.rows[l][o]+";"+h.rows[l][q]+'"></td>');if(d.options.columns[g].width!=b){s.attr("width",d.options.columns[g].width)}}else{s=a("<td></td>");if(d.options.columns[g].width!=b){s.attr("width",d.options.columns[g].width)}}var c=d.options.columns[g].text;var r=h.rows[l][c];s.append(r);f.append(s)}a("#"+n+" .tab_data table").append(f)}}else{f=a('<tr class="first_row nodata_row"><td width="70"></td></tr>');for(var g=0;g<d.options.columns.length;g++){s=a("<td></td>");if(d.options.columns[g].width!=b){s.attr("width",d.options.columns[g].width)}f.append(s)}a("#"+n+" .tab_data table").append(f)}a("#"+n+" .tab_data table tbody").addClass("data_body");d.setWidth();d.setHeight();d.headScroll();d.toEdit();d.toDelete()},toDelete:function(){var d=this;var c=d.element.context.id;a("#"+c+" .del_btn").each(function(){var e=this;a(e).unbind("click");a(e).click(function(){var f=a(e).parent().parent().index();d.delData.push(d.tabledata[f]);a(e).parent().parent().addClass("hasDel").children("td").append('<div class="del_line"></div>');a(e).parent().parent().addClass("hasDel").children("td").eq(0).find("span").unbind("click").css("cursor","not-allowed")})})},toCancelEdit:function(){var d=this;var c=d.element.context.id;a("#"+c+" .cancel_btn").each(function(){var e=this;a(e).unbind();a(e).click(function(){a("span.promptbox").remove();if(a(e).parent().parent().hasClass("first_row")){a(e).parent().parent().attr("class","first_row")}else{if(a(e).parent().parent().hasClass("row_col")){a(e).parent().parent().attr("class","row_col")}else{a(e).parent().parent().removeAttr("class")}}a(e).parent().parent().unbind("mouseleave");var k=a(e).parent().parent().index();var i=d.tabledata[k];var g=a(e).parent().parent();g.html('<td width="100"><span class="glyphicon glyphicon-edit edit_btn"></span><span class="glyphicon glyphicon-trash del_btn"></span></td>');for(var h=0;h<d.options.columns.length;h++){if(d.options.columns[h].type==4||d.options.columns[h].type==5||d.options.columns[h].type==0){var l=d.options.columns[h].id;var m=d.options.columns[h].text;var o=a('<td index="'+i[l]+";"+i[m]+'"></td>')}else{var o=a("<td></td>")}var f=d.options.columns[h].text;var n=i[f];o.append(n);o.attr("width",d.tdWid[h+1]);g.append(o)}d.toDelSame(i,"editing");d.toEdit();d.toDelete();d.setWidth()})})},toEdit:function(){var e=this;var c=e.element.context.id;var d=e.options.columns;a("#"+c+" .edit_btn").each(function(){var f=this;a(f).unbind("click");a(f).click(function(){var i=e.toSetRowNum(0);a(f).parent().parent().addClass("editing  row_"+i).children("td").addClass("tr_bg");var g=a(f).parent().parent().index();var h=a(f).parent().parent().find("td");h.eq(0).html('<span class="glyphicon glyphicon-remove cancel_btn"></span>');h.eq(0).css("background","#99CADE");e.addItem=0;e.typeByNumber(h,i);e.moveOutToSave();e.toCancelEdit();e.setWidth()})})},typeByNumber:function(f,j){var d=this;var k=d.element.context.id;var e=d.options.columns;for(var g=0;g<e.length;g++){if(e[g].type==5){d.addItem++;var m;if(f.eq(g+1).attr("index")){m=f.eq(g+1).attr("index").split(";")}else{m=["",""]}var h='<input type="hidden" check="'+e[g].check+'" id="'+e[g].id+"_"+(g+1)+"_"+j+'" name="'+e[g].id+'">';f.eq(g+1).html(h);f.eq(g+1);var c={id:e[g].id+"_"+(g+1)+"_"+j,Hid:e[g].Hid,Htext:e[g].Htext,index:m[0],indexShow:m[1],url:e[g].url};if(e[g].afterSelect){c.afterSelect=e[g].afterSelect}if(e[g].beforeSelect){c.beforeSelect=e[g].beforeSelect}if(e[g].checked==true){c.checked="checked"}d.setCombogrid(c)}else{if(e[g].type==2){d.addItem++;var h=f.eq(g+1).html();f.eq(g+1).html('<input class="Wdate" id="'+e[g].text+"_"+(g+1)+"_"+j+'" type="text" name="'+e[g].text+'" check="'+e[g].check+'"/>');f.eq(g+1).children("input").val(h);var c={id:e[g].text+"_"+(g+1)+"_"+j,format:e[g].format};d.setDatepicker(c)}else{if(e[g].type==3){d.addItem++;var h=f.eq(g+1).html();f.eq(g+1).html('<input class="change_text" id="'+e[g].text+"_"+(g+1)+"_"+j+'" type="text" name="'+e[g].text+'" placeholder="请填写数字" check="'+e[g].check+'"/>');f.eq(g+1).children("input").val(h);var c={id:e[g].text+"_"+(g+1)+"_"+j,format:e[g].format};d.setNum(c)}else{if(e[g].type==1){d.addItem++;var h=f.eq(g+1).html();f.eq(g+1).html('<input class="change_text" type="text" id="'+e[g].text+"_"+(g+1)+"_"+j+'" name="'+e[g].text+'" check="'+e[g].check+'"/>');f.eq(g+1).children("input").val(h)}else{if(e[g].type==0){d.addItem++;var h=f.eq(g+1).html();var m;if(f.eq(g+1).attr("index")){m=f.eq(g+1).attr("index").split(";")}else{m=["",""]}f.eq(g+1).html('<input class="change_text change_type" type="text" id="'+e[g].id+"_"+(g+1)+"_"+j+'" name="'+e[g].id+'" check="'+e[g].check+'"/>');f.eq(g+1).children("input").val(h);if(m){e[g].beforeSelect(e[g].id+"_"+(g+1)+"_"+j,m)}}else{if(e[g].type==4){d.addItem++;var m;if(f.eq(g+1).attr("index")){m=f.eq(g+1).attr("index").split(";")}else{m=["",""]}var h='<select id="'+e[g].id+"_"+(g+1)+"_"+j+'"  name="'+e[g].id+'" style="display: none"  check="'+e[g].check+'"></select>';f.eq(g+1).html(h);if(e[g].url!=b){var l=e[g].url}else{var l=e[g].staticData}var c={id:e[g].id+"_"+(g+1)+"_"+j,Hid:e[g].Hid,Htext:e[g].Htext,index:m[0],indexShow:m[1],dataopt:l};if(e[g].afterSelect){c.afterSelect=e[g].afterSelect}if(e[g].beforeSelect){c.beforeSelect=e[g].beforeSelect}if(e[g].checked==true){c.checked="checked"}d.setCombo(c)}else{f.eq(g+1).css("background","#99CADE")}}}}}}}},typeByData:function(f,k,g){var d=this;var e=d.options.columns;for(var h=0;h<e.length;h++){if(e[h].type==5){d.addItem++;var m=d.options.columns[h].id;var n=m+"Show";var j='<input type="hidden" check="'+e[h].check+'" id="'+e[h].id+"_"+(h+1)+"_"+k+'" name="'+e[h].id+'">';f.eq(h+1).html(j);var c={id:e[h].id+"_"+(h+1)+"_"+k,Hid:e[h].Hid,Htext:e[h].Htext,index:g[m],indexShow:g[n],url:e[h].url};if(e[h].afterSelect){c.afterSelect=e[h].afterSelect}if(e[h].beforeSelect){c.beforeSelect=e[h].beforeSelect}if(e[h].checked==true){c.checked="checked"}d.setCombogrid(c)}else{if(e[h].type==1){d.addItem++;var m=d.options.columns[h].text;var j=g[m];f.eq(h+1).html('<input class="change_text" type="text" id="'+e[h].text+"_"+(h+1)+"_"+k+'" name="'+e[h].text+'" check="'+e[h].check+'"/>');f.eq(h+1).children("input").val(j)}else{if(e[h].type==0){d.addItem++;var m=d.options.columns[h].id;var j=g[m];var n=m+"Show";f.eq(h+1).html('<input class="change_text change_type" type="text" id="'+e[h].id+"_"+(h+1)+"_"+k+'" name="'+e[h].id+'" check="'+e[h].check+'"/>');if(m){e[h].beforeSelect(e[h].id+"_"+(h+1)+"_"+k,[g[m],g[n]])}}else{if(e[h].type==2){d.addItem++;var m=d.options.columns[h].text;var j=g[m];f.eq(h+1).html('<input class="Wdate" id="'+e[h].text+"_"+(h+1)+"_"+k+'" type="text" name="'+e[h].text+'" check="'+e[h].check+'"/>');f.eq(h+1).children("input").val(j);var c={id:e[h].text+"_"+(h+1)+"_"+k,format:e[h].format};d.setDatepicker(c)}else{if(e[h].type==3){d.addItem++;var m=d.options.columns[h].text;var j=g[m];f.eq(h+1).html('<input class="change_text" id="'+e[h].text+"_"+(h+1)+"_"+k+'" type="text" name="'+e[h].text+'" placeholder="请填写数字" check="'+e[h].check+'"/>');f.eq(h+1).children("input").val(j);var c={id:e[h].text+"_"+(h+1)+"_"+k,format:e[h].format};d.setNum(c)}else{if(e[h].type==4){d.addItem++;var m=d.options.columns[h].id;var n=m+"Show";var j='<select id="'+e[h].id+"_"+(h+1)+"_"+k+'"  name="'+e[h].id+'" style="display: none"  check="'+e[h].check+'"></select>';f.eq(h+1).html(j);if(e[h].url!=b){var l=e[h].url}else{var l=e[h].staticData}var c={id:e[h].id+"_"+(h+1)+"_"+k,Hid:e[h].Hid,Htext:e[h].Htext,index:g[m],indexShow:g[n],dataopt:l};if(e[h].afterSelect){c.afterSelect=e[h].afterSelect}if(e[h].beforeSelect){c.beforeSelect=e[h].beforeSelect}if(e[h].checked==true){c.checked="checked"}d.setCombo(c)}else{f.eq(h+1).css("background","#99CADE")}}}}}}}},setCombo:function(e){var h=this;var g="";var d="";var c;if(typeof(e.dataopt)=="object"){g="";d=e.dataopt}else{g=e.dataopt;d=""}var f=false;if(e.checked=="checked"){f=true}a("#"+e.id).RCombo({dataUrl:g,valueField:e.Hid,displayField:e.Htext,staticData:d,icon:false,multiSelect:f,ifEditGrid:true});if(e.index){a("#"+e.id).RCombo("setAllValue",[e.index,e.indexShow])}if(e.beforeSelect){a("#"+e.id).RCombo("beforeSelect",e.beforeSelect)}if(e.afterSelect){a("#"+e.id).RCombo("afterSelect",e.afterSelect)}},setCombogrid:function(d){var f=this;var c;var e=false;if(d.checked=="checked"){e=true}a("#"+d.id).RComboGrid({idField:d.Hid,textField:d.Htext,url:d.url,method:"post",pageSize:6,columns:[{title:"名称",field:d.Htext}],icon:false,multiSelect:e,showText:e,ifEditGrid:true});if(d.index){a("#"+d.id).RComboGrid("setAllValue",[d.index,d.indexShow])}if(d.beforeSelect){a("#"+d.id).RComboGrid("beforeSelect",d.beforeSelect)}if(d.afterSelect){a("#"+d.id).RComboGrid("afterSelect",d.afterSelect)}},setDatepicker:function(c){var d=this;var e="";if(a("#"+c.id).parents("tr").hasClass("editing")){e="editing"}else{if(a("#"+c.id).parents("tr").hasClass("adding")){e="adding"}}a("#"+c.id).RCalendar({dateFmt:c.format});a("#"+c.id).RCalendar("afterSelect",function(){d.saveValue(e)})},setNum:function(c){a("#"+c.id).RNumberField({dataFmt:c.format})},saveAll:function(d){var e=this;var c=e.element.context.id;a("#"+c+" ."+d).bind("click",function(){e.options.saveFn()})},getDelArray:function(){var c=[];if(this.options.primaryKey.length==1){for(var d=0;d<this.delData.length;d++){c.push(this.delData[d][this.options.primaryKey[0]])}}return c},getEditValue:function(){return this.editData},getDelValue:function(){return this.delData},getAddValue:function(){return this.addData},getAllValue:function(){var c=this;var l=c.tabledata.slice();var h=c.delData.slice();var n=c.editData.slice();var m=c.options.primaryKey.slice();var g=true;for(var f=0;f<l.length;f++){for(var e=0;e<h.length;e++){g=true;for(var d=0;d<m.length;d++){if(l[f][m[d]]!=h[e][m[d]]){g=false}}if(g){l.splice(f,1)}}}for(var f=0;f<l.length;f++){for(var e=0;e<n.length;e++){g=true;for(var d=0;d<m.length;d++){if(l[f][m[d]]!=n[e][m[d]]){g=false}}if(g){a.extend(l[f],n[e])}}}l=l.concat(c.addData);return l},setPage:function(d,h){var g=this;var c=g.element.context.id;var f='<button class="add_btn">新增</button><span class="page_nav"><span class="page_bgimg"></span><span class="page_bgimg page_bgimg_pos1"></span><span class="page_num">'+d[0]+'</span>/<span class="page_all">  '+d[1]+'</span><span class="page_bgimg page_bgimg_pos2"></span><span class="page_bgimg page_bgimg_pos3"></span></span><p>共'+d[2]+"条</p>";a("#"+c+" .tab_page").html(f);if(g.options.initialize){for(var e=g.options.initialize.length-1;e>-1;e--){g.addBtn(g.options.initialize[e][0],"initialize_"+e);if(g.options.initialize[e][1]){g.initialize(g.options.initialize[e][1],"initialize_"+e)}else{g.saveAll("initialize_"+e)}}}a("#"+c+" .page_nav span:eq(4)").click(function(){g.next(d)});a("#"+c+" .page_nav span:eq(1)").click(function(){g.prev(d)});a("#"+c+" .page_nav span:eq(5)").click(function(){g.last(d)});a("#"+c+" .page_nav span:eq(0)").click(function(){g.first(d)});g.addRow();g.saveEdit()},prev:function(c){var f=this;var e=parseInt(c[0])-1;var d={page:e,rows:f.options.pageSize};if(e>0){f.pageTurn(d)}},next:function(c){var f=this;var e=parseInt(c[0])+1;var d={page:e,rows:f.options.pageSize};if(e<=c[1]){f.pageTurn(d)}},first:function(c){var f=this;var e=1;var d={page:e,rows:f.options.pageSize};f.pageTurn(d)},last:function(c){var f=this;var e=c[1];var d={page:e,rows:f.options.pageSize};f.pageTurn(d)},pageTurn:function(f){var e=this;var c=e.element.context.id;a("#"+c+"_form").RValidate({success:d,scroll:true});a("#"+c+"_form").RValidate("validate");function d(){e.getData(f);e.toFindDel();e.toFindEdit();e.toFindAdd()}},addRow:function(){var e=this;var c=e.element.context.id;var d=e.options.columns;var f=0;a("#"+c+" .add_btn").click(function(){a("span.promptbox").remove();a("#"+c+" .promptinput").removeClass("promptinput");e.addItem=0;f=e.toSetRowNum(f);var j=a('<tr class="row_'+f+' adding"><td class="tr_bg" width="70"></td></tr>');for(var h=0;h<e.options.columns.length;h++){j.append('<td class="tr_bg"></td>')}a("#"+c+" .data_body").append(j);var g=a("#"+c+" .row_"+f).find("td");g.eq(0).html('<span class=" glyphicon glyphicon-ban-circle cancel_add"></span>');g.eq(0).css("background","#99CADE");e.typeByNumber(g,f);e.moveOutToSave();e.cancelAdd();e.setWidth()})},toGetNum:function(d){var c=/\d+/g;return d.match(c)},toSetRowNum:function(k){var j=this;var d=j.element.context.id;var g=a("#"+d+" tr.adding,#"+d+" tr.editing");var c=g.length;var f;var e=false;for(var h=0;h<c;h++){f=j.toGetNum(g.eq(h).attr("class"))[0];if(f==k){e=true}}if(e==true){k++;return j.toSetRowNum(k)}else{return k}},cancelAdd:function(){var g=this;var c=g.element.context.id;var e=/\d+/g;var f=parseInt(a("#"+c+" span.page_num").html());var h="";var d="";a("#"+c+" .cancel_add").click(function(){h=a(this).parent().parent().attr("class");d=f+"_"+h.match(e)[0];for(var j=0;j<g.addData.length;j++){if(g.addData[j].useforfind==d){g.addData.splice(j,1)}}a(this).parent().parent().remove();a("span.promptbox").remove();a("#"+c+" .promptinput").removeClass("promptinput");g.setWidth()})},moveOutToSave:function(){var d=this;var c=d.element.context.id;if(a("span.promptbox").length==0){a("#"+c+" tr.editing").each(function(){var e=this;a(e).bind("mouseleave",function(){d.saveValue("editing")})});a("#"+c+" tr.adding").each(function(){var e=this;a(e).bind("mouseleave",function(){d.saveValue("adding")})})}},afterSelectToSave:function(){},saveEdit:function(){var d=this;var c=d.element.context.id;a("#"+c+" tr ").unbind("click");a("#"+c+" .save_alladd").click(function(){d.saveValue(null)})},toValidate:function(e){var f=this;var d=f.element.context.id;a("#"+d+"_form").RValidate({success:e,scroll:true});var c=a("#"+d+"_form").RValidate("validate");return c},saveValue:function(d){var f=this;var c=f.element.context.id;e(d);function e(p){var q=a("#"+c+" .data_body").children("tr."+p).length;var r=parseInt(a("#"+c+" span.page_num").html());var h=/\d+/g;for(var m=0;m<q;m++){var o=a("#"+c+" .data_body").children("tr."+p).eq(m).index();var s=a("#"+c+" .data_body").children("tr."+p).eq(m).find("input,select");var g={};for(var n=0;n<s.length;n++){if(s.eq(n).attr("name")!=b){if(s.eq(n).attr("combogrid")=="true"){g[s.eq(n).attr("name")+"Show"]=s.eq(n).parent().find("input.input_text").val()}else{if(s.eq(n)[0].nodeName.toUpperCase()=="SELECT"){g[s.eq(n).attr("name")+"Show"]=s.eq(n).parent().find(".combo_text input").val()}else{if(s.eq(n).hasClass("hid_val")){g[s.eq(n).attr("name")+"Show"]=s.eq(n).parent().find(".combo_text input").val()}}}g[s.eq(n).attr("name")]=s.eq(n).val()}}if(p=="editing"){var k=a("#"+c+" .data_body").children("tr."+p).eq(m).attr("class");g.useforfind=k.match(h)[0];var l=a.extend({},f.allpKey[o],g);f.toDelSame(l,p);f.editData.push(l)}else{var k=a("#"+c+" .data_body").children("tr."+p).eq(m).attr("class");g.useforfind=r+"_"+k.match(h)[0];f.toDelSame(g,p);f.addData.push(g)}}}},toDelSame:function(h,i){var g=this;var d=g.element.context.id;var e=false;if(i=="editing"){for(var f=0;f<g.editData.length;f++){for(var c=0;c<g.options.primaryKey.length;c++){e=false;if(g.editData[f][g.options.primaryKey[c]]!=h[g.options.primaryKey[c]]){e=true}}if(e==false){g.editData.splice(f,1)}}}else{for(var f=0;f<g.addData.length;f++){if(g.addData[f]["useforfind"]==h.useforfind){g.addData.splice(f,1)}}}},initialize:function(d,f){var e=this;var c=e.element.context.id;a("#"+c+" .tab_page button."+f).unbind("click");a("#"+c+" .tab_page button."+f).bind("click",function(){a.ajax({url:d,type:"POST",cache:false,success:function(g){g=JSON.parse(g);g=g.rows;e.showData(g)},error:function(){}})})},showData:function(f){var c=this;var h=c.element.context.id;var m=0;var d=c.options.columns;a("span.promptbox").remove();if(a("#"+h+" .save_btn").length!=0){alert("请先保存更改！");return false}if(a("#"+h+" .cancel_add").length!=0){alert("请先保存添加！");return false}for(var e=0;e<f.length;e++){c.addItem=0;m=c.toSetRowNum(m);var j=a('<tr class="row_'+m+' adding"><td class="tr_bg" width="70"></td></tr>');for(var g=0;g<c.options.columns.length;g++){j.append('<td class="tr_bg"></td>')}a("#"+h+" .data_body").append(j);var l=a("#"+h+" .row_"+m).find("td");l.eq(0).html('<span class=" glyphicon glyphicon-ban-circle cancel_add"></span>');l.eq(0).css("background","#99CADE");c.typeByData(l,m,f[e]);c.moveOutToSave();c.cancelAdd()}},addBtn:function(f,d){var e=this;var c=e.element.context.id;a('<button class="'+d+'">'+f+"</button>").insertAfter(a("#"+c+" .tab_page button:last"))},toFindDel:function(){var i=this;var d=i.element.context.id;var h=i.options.columns;var e=false;for(var f=0;f<i.delData.length;f++){for(var g=0;g<i.tabledata.length;g++){for(var c=0;c<i.options.primaryKey.length;c++){e=false;if(i.delData[f][i.options.primaryKey[c]]!=i.tabledata[g][i.options.primaryKey[c]]){e=true}}if(e==false){a("#"+d+" .data_body").children("tr").eq(g).addClass("hasDel").children("td").append('<div class="del_line"></div>');a("#"+d+" .data_body").children("tr").eq(g).children("td").eq(0).find("span").unbind("click").css("cursor","not-allowed")}}}},toFindEdit:function(){var c=this;var l=c.element.context.id;var d=c.options.columns;var i=false;for(var f=0;f<c.editData.length;f++){for(var g=0;g<c.tabledata.length;g++){for(var e=0;e<c.options.primaryKey.length;e++){i=false;if(c.editData[f][c.options.primaryKey[e]]!=c.tabledata[g][c.options.primaryKey[e]]){i=true}}if(i==false){var h=c.editData[f].useforfind;a("#"+l+" .data_body").children("tr").eq(g).addClass("editing row_"+h).find("td:not(.hid_td)").addClass("tr_bg");var n=a("#"+l+" .data_body").children("tr").eq(g).find("td");n.eq(0).html('<span class="glyphicon glyphicon-remove cancel_btn"></span>');n.eq(0).css("background","#99CADE");c.addItem=0;c.typeByData(n,h,c.editData[f]);c.moveOutToSave();c.toCancelEdit();c.setWidth()}}}},toFindAdd:function(){var c=this;var g=c.element.context.id;var d=c.options.columns;var m;var h=parseInt(a("#"+g+" .page_num").html());for(var e=0;e<c.addData.length;e++){if(c.toGetNum(c.addData[e].useforfind)[0]==h){c.addItem=0;m=c.toGetNum(c.addData[e].useforfind)[1];var j=a('<tr class="row_'+m+' adding"><td class="tr_bg" width="70"></td></tr>');for(var f=0;f<c.options.columns.length;f++){j.append('<td class="tr_bg"></td>')}a("#"+g+" .data_body").append(j);var l=a("#"+g+" .row_"+m).find("td");l.eq(0).html('<span class=" glyphicon glyphicon-ban-circle cancel_add"></span>');l.eq(0).css("background","#99CADE");c.typeByData(l,m,c.addData[e]);c.moveOutToSave();c.cancelAdd();c.setWidth()}}},changeType:function(f){var g=this;var i=f.id;var d=f.type;var h=f.param;var e="";var c="";e=a("#"+i).attr("name");c=a("#"+i).attr("check");switch(parseInt(d)){case 5:a("#"+i).parents("td").html('<input type="hidden" name="'+e+'" id="'+i+'" check="'+c+'"/>');h.ifEditGrid=true;a("#"+i).RComboGrid(h);break;case 4:a("#"+i).parents("td").html('<select id="'+i+'" name="'+e+'" style="display: none" check="'+c+'"></select>');h.ifEditGrid=true;a("#"+i).RCombo(h);break;case 3:a("#"+i).parents("td").html('<input id="'+i+'"  class="change_text" name="'+e+'"  placeholder="请填写数字" check="'+c+'">');a("#"+i).RNumberField(h);break;case 2:a("#"+i).parents("td").html('<input id="'+i+'"  class="Wdate" name="'+e+'"  check="'+c+'">');a("#"+i).RCalendar(h);a("#"+i).RCalendar("afterSelect",function(){g.saveValue("editing")});break;case 1:a("#"+i).parents("td").html('<input class="change_text" id="'+i+'"  name="'+e+'"  check="'+c+'">');a("#"+i).RTextField(h);break}},destroy:function(){a.Widget.prototype.destroy.call(this)}})})(jQuery);(function(a,b){a.widget("RUI.GroupGrid",{options:{dataUrl:"",columns:[],pageSize:"",pid:"pid",id:"id",width:"",isExtend:true},widArr:[],panelHeight:null,param:null,_create:function(){},_init:function(){var e=this;var c=e.element.context.id;var d='<div class="tab_wrap"><div class="tab_title"><table cellpadding="0" cellspacing="0"><thead></thead></table></div>';d+='<div class="tab_data"><table cellpadding="0" cellspacing="0"><tbody></tbody></table></div></div>';d+='<div class="tab_page"></div>';a("#"+c).html(d);e.setHead();e.getData({page:1,rows:e.options.pageSize})},setHead:function(){var g=this;var c=g.element.context.id;var d=g.options;var f=a("<tr><th></th><th></th></tr>");for(var e=0;e<d.columns.length;e++){f.append("<th>"+d.columns[e].title+"</th>")}a("#"+c+" .tab_title table thead").append(f)},setWidth:function(){var f=this;var c=f.element.context.id;var e=[];var g=0;a("#"+c+" .tab_data tr:first td").eq(0).outerWidth(f.options.width);a("#"+c+" .tab_data tr:first td").eq(1).outerWidth(25);for(var d=0;d<a("#"+c+" .tab_data tr:first td").length;d++){if(d!=0){if(d==1){e.push(25);g+=25}else{e.push(a("#"+c+" .tab_data tr:first td").eq(d).outerWidth());g+=parseInt(a("#"+c+" .tab_data tr:first td").eq(d).outerWidth())}}else{e.push(parseInt(f.options.width));g+=parseInt(f.options.width)}}a("#"+c+" .tab_data table").width(g);f.widArr=e;for(var d=0;d<e.length;d++){a("#"+c+" .tab_title th").eq(d).outerWidth(e[d])}a("#"+c+" .tab_title table").width(g);f.collapseItem()},setHeight:function(){var g=this;var d=g.element.context.id;if(g.panelHeight){a("#"+d+" .tab_data").css("height",g.panelHeight)}else{a("#"+d).parents("body").css({height:"100%",width:"100%"});a("#"+d).parents("html").css({height:"100%",width:"100%"});var f=0;var c=a("#"+d).parent().siblings("div").length;for(var e=0;e<c;e++){f+=a("#"+d).parent().siblings("div").eq(e).height()}f=f+90;a("#"+d).parent().css({padding:"9px 10px",background:"white"});a("#"+d+" .tab_data").css("height",(a("body").height()-f));g.panelHeight=(a("body").height()-f)}},headScroll:function(){var d=this;var c=d.element.context.id;a("#"+c+" .tab_data").scroll(function(){a("#"+c+" .tab_title").scrollLeft(a(this).scrollLeft())})},setGridParam:function(e){var f=this;var c=f.element.context.id;var d=f.options;f.param=e;e.page=1;e.rows=f.options.pageSize;a.ajax({url:d.dataUrl,type:"POST",data:e,cache:false,success:function(g){g=JSON.parse(g);if(g.rows.length==0){a("#"+c+" .tab_data table tbody").html("");a("#"+c+" .page_num").html("0");a("#"+c+" .page_all").html("0");a("#"+c+" .tab_page p").html("共0条")}else{f.setBody(g.rows);f.setPage([e.page,g.totalpage,g.total],g)}},error:function(){}})},getData:function(e){var f=this;var c=f.element.context.id;var d=f.options;if(f.param){e=a.extend({},f.param,e)}a.ajax({url:d.dataUrl,type:"POST",data:e,cache:false,success:function(g){if(typeof(g)!="object"){g=JSON.parse(g)}f.setBody(g.rows);f.setPage([e.page,g.totalpage,g.total],g)},error:function(){}})},setBody:function(x){var q=this;var g=q.element.context.id;var d=x;var m=[];var t=d.length;var c=q.options.columns;var f=1;var w=0;var v=q.options.pid;var u=q.options.id;if(t>0){a("#"+g+" .tab_data table tbody").html("");var e=a("#"+g+" .tab_data tbody");for(var r=0;r<t;r++){var n=d[r].rpath;if((n.length-n.replace(/#/g,"").length-1)==0){for(var o=0;o<d.length;o++){if(d[r].checked=="true"){var s='<input type="checkbox" />'}else{var s=""}if(d[o][v]==d[r][u]){var h=a('<tr index="'+d[r][u]+'" ifp="true" root="true" pid="'+d[r][v]+'"><td><span class="glyphicon glyphicon-plus file_open"></span></td><td class="check_min_w">'+s+"</td></tr>");break}else{var h=a('<tr index="'+d[r][u]+'" root="true" pid="'+d[r][v]+'"><td><span class="glyphicon glyphicon-file file_item"></span></td><td>'+s+"</td></tr>")}}for(var p=0;p<c.length;p++){var y=c[p].text;h.append('<td class="tab_data_td">'+d[r][y]+"</td>")}e.append(h);m.push(d[r])}}for(var r=0;r<m.length;r++){for(var p=0;p<d.length;p++){if(m[r]==d[p]){d.splice(p,1)}}}k();function k(){var z=d.length;m=[];if(z>0){for(var C=0;C<z;C++){var F=d[C].rpath;if((F.length-F.replace(/#/g,"").length-1)==f){w=20*f;for(var A=0;A<d.length;A++){if(d[C].checked=="true"){var G='<input type="checkbox" />'}else{var G=""}if(d[A][v]==d[C][u]){var D=a('<tr index="'+d[C][u]+'" ifp="true" pid="'+d[C][v]+'"><td style="padding-left: '+w+'px"><span class="glyphicon glyphicon-plus file_open"></span></td><td class="check_min_w">'+G+"</td></tr>");break}else{var D=a('<tr index="'+d[C][u]+'" pid="'+d[C][v]+'"><td style="padding-left: '+w+'px"><span class="glyphicon glyphicon-file file_item"></span></td><td class="check_min_w">'+G+"</td></tr>")}}for(var B=0;B<c.length;B++){var E=c[B].text;D.append('<td class="tab_data_td">'+d[C][E]+"</td>")}a("#"+g+" .tab_data tbody tr").each(function(){if(a(this).attr("index")==d[C][v]){D.insertAfter(a(this))}});m.push(d[C])}}for(var C=0;C<m.length;C++){for(var B=0;B<d.length;B++){if(m[C]==d[B]){d.splice(B,1)}}}f++;k()}}a("#"+g+" .tab_data table").append(e)}q.setWidth();q.headScroll();q.setHeight();q.choiceRow();if(q.options.isExtend){q.allExtend()}},collapseItem:function(){var g=this;var c=g.element.context.id;a("#"+c+" .tab_data tr").css("display","none");a("#"+c+" .tab_data tr[root = true]").css("display","block");for(var d=0;d<a("#"+c+" .tab_data tr").length;d++){for(var e=0;e<g.widArr.length;e++){a("#"+c+" .tab_data tr").eq(d).find("td").eq(e).outerWidth(g.widArr[e])}}a("#"+c+" .tab_data tr[ifp = true]").each(function(){var h=a(this).attr("index");a(this).find("span").click(function(){a(this).toggleClass("glyphicon-minus");a(".tab_data tr").each(function(){if(a(this).attr("pid")==h){a(this).toggleClass("dis");for(var j=0;j<g.widArr.length;j++){a(this).find("td").eq(j).outerWidth(g.widArr[j])}f(this)}})})});function f(j){var h=a(j).attr("index");a(j).find("span").removeClass("glyphicon-minus");a(".tab_data tr").each(function(){if(a(this).attr("pid")==h){a(this).removeClass("dis");f(this)}})}},allExtend:function(){var e=this;var c=e.element.context.id;a("#"+c+" .tab_data tr[ifp = true]").each(function(){var f=a(this).attr("index");a(this).find("span").toggleClass("glyphicon-minus");a(".tab_data tr").each(function(){if(a(this).attr("pid")==f){a(this).toggleClass("dis");for(var g=0;g<e.widArr.length;g++){a(this).find("td").eq(g).outerWidth(e.widArr[g])}d(this)}})});function d(g){var f=a(g).attr("index");a(g).find("span").removeClass("glyphicon-minus");a(".tab_data tr").each(function(){if(a(this).attr("pid")==f){a(this).removeClass("dis");d(this)}})}},choiceRow:function(){var d=this;var c=d.element.context.id;a("#"+c+" input[type=checkbox]").bind("click",function(){if(a(this).parent().parent().hasClass("choice")){a(this).parent().parent().css("background","#FFFFFF");a(this).parent().parent().removeClass("choice")}else{a(this).parent().parent().css("background","#DCEDF3");a(this).parent().parent().addClass("choice")}})},getParent:function(){var g=this;var d=g.element.context.id;var c;var f=[];var e=a("#"+d+" .tab_data table tr.choice");e.each(function(){c=[];c.push(a(this).attr("pid"));c.push(a(this).attr("index"));f.push(c)});return f},setPage:function(d,h){var g=this;var c=g.element.context.id;var e=g.options;var f='<table class="ui-pg-table" style="width:100%;table-layout:fixed;height:100%;" role="row" cellspacing="0" cellpadding="0" border="0"><tbody><tr><td align="left"></td><td style="white-space: pre; width: 322px;" align="center"><table style="table-layout:auto;" class="ui-pg-table" cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="ui-pg-button ui-corner-all " ><span class="ui-icon ace-icon fa fa-angle-double-left bigger-140"></span></td><td  class="ui-pg-button ui-corner-all"><span class="ui-icon ace-icon fa fa-angle-left bigger-140"></span></td><td class="ui-pg-button " style="width:4px;"><span class="ui-separator"></span></td><td dir="ltr"> <input class="ui-pg-input"  role="textbox" type="text" value="'+d[0]+'"> 共 <span ">'+d[1]+'</span> 页</td><td class="ui-pg-button" style="width: 4px;"><span class="ui-separator"></span></td><td  class="ui-pg-button ui-corner-all"><span class="ui-icon ace-icon fa fa-angle-right bigger-140"></span></td><td  class="ui-pg-button ui-corner-all"><span class="ui-icon ace-icon fa fa-angle-double-right bigger-140"></span></td><td dir="ltr"></td></tr></tbody></table></td><td align="right"><div dir="ltr" style="text-align:right" class="ui-paging-info">共'+d[2]+"条</div></td></tr></tbody></table>";a("#"+c+" .tab_page").html(f);if(d[0]==d[1]){a("#"+c+" .ui-pg-button:eq(5)").addClass("ui-state-disabled");a("#"+c+" .ui-pg-button:eq(4)").addClass("ui-state-disabled")}else{if(d[0]==1){a("#"+c+" .ui-pg-button:eq(0)").addClass("ui-state-disabled");a("#"+c+" .ui-pg-button:eq(1)").addClass("ui-state-disabled")}}a("#"+c+"  .ui-pg-button:eq(4)").click(function(){g.next(d)});a("#"+c+"  .ui-pg-button:eq(1)").click(function(){g.prev(d)});a("#"+c+"  .ui-pg-button:eq(5)").click(function(){g.last(d)});a("#"+c+"  .ui-pg-button:eq(0)").click(function(){g.first(d)})},reloadGrid:function(){var c=this;c.getData({page:1,rows:c.options.pageSize})},prev:function(c){var f=this;var e=parseInt(c[0])-1;var d={page:e,rows:f.options.pageSize};if(e>0){f.getData(d)}},next:function(c){var f=this;var e=parseInt(c[0])+1;var d={page:e,rows:f.options.pageSize};if(e<=c[1]){f.getData(d)}},first:function(c){var f=this;var e=1;var d={page:e,rows:f.options.pageSize};f.getData(d)},last:function(d){var g=this;var c=g.element.context.id;var f=d[1];var e={page:f,rows:g.options.pageSize};g.getData(e);a("#"+c+" .ui-pg-button:eq(5)").addClass("ui-state-disabled");a("#"+c+" .ui-pg-button:eq(4)").addClass("ui-state-disabled")},destroy:function(){a.Widget.prototype.destroy.call(this)}})})(jQuery);(function(a,b){a.widget("RUI.RMultiSelect",{option:{},_init:function(){},_create:function(){var c=this;var d=c.element.context.id;a("#"+d).css({height:"152px",overflow:"auto",border:"1px solid #DDDDDD",padding:"5px"});a("#"+d).append('<table class="val_Tab"></table>')},getValue:function(){var c=this;var f=c.element.context.id;var e=a("#"+f).attr("boxFor");var d=a("#"+e).RComboGrid("selectCheckbox");return d}})})(jQuery);(function($,undefined){$.widget("RUI.RUploadfile",{options:{dataUrl:"",addUrl:"",downloadUrl:"",fileTypeExts:"",fileSizeLimit:"",queueSizeLimit:"",uploadSuccess:null,uploadError:null,showfileList:true,autoUpload:false,disabled:false},delData:[],addData:[],_init:function(){},_create:function(){var ME=this;var ID=ME.element.context.id;var mess=ME.flashChecker();if(ME.options.showfileList){$("#"+ID).html('<div class="title"><span class="glyphicon glyphicon-cloud-upload"></span>附件上传(保存后自动上传)<span class="uploadmessage">'+mess+'</span></div><div class="uploaded"><table><tr><th>操作</th><th>文件名称</th><th>文件大小</th><th>上传用户</th><th>上传时间</th></tr> </table> </div><div class="upload_Btn"><input id="'+ID+'_btn" name="file_upload" type="file" multiple="true"></div>')}else{$("#"+ID).html('<input id="'+ID+'_btn" name="file_upload" type="file" multiple="true">');$("#"+ID).removeAttr("class")}ME.getData();ME.setOptions()},getData:function(){var ME=this;var ID=ME.element.context.id;if(ME.options.dataUrl!=""){$.ajax({url:ME.options.dataUrl,type:"GET",cache:false,success:function(data){if(typeof(data)!="object"){data=JSON.parse(data)}ME.setTable(data.rows)},error:function(err){}})}},setTable:function(data){var ME=this;var ID=ME.element.context.id;for(var i=0;i<data.length;i++){$("#"+ID+" table").append('<tr><td><span index="'+data[i].storageid+'" class=" glyphicon glyphicon-remove-circle remove_file"></span>&nbsp;<a href="'+ME.options.downloadUrl+"?ids="+data[i].storageid+'" class=" glyphicon glyphicon-download download_file"></a></td><td>'+data[i].filename+"</td><td>"+data[i].filesize+"</td><td>"+data[i].creatorname+"</td><td>"+data[i].createdate+"</td></tr>")}ME.delFile(ME.options.disabled)},setOptions:function(){var ME=this;var ID=ME.element.context.id;$("#"+ID+"_btn").uploadify({swf:getRootPath_web()+"/CYUI/plugins/uploadify/uploadify.swf",uploader:ME.options.addUrl,auto:ME.options.autoUpload,buttonText:"选择文件",width:100,removeCompleted:true,fileTypeExts:ME.options.fileTypeExts,multi:true,queueSizeLimit:ME.options.queueSizeLimit,fileSizeLimit:ME.options.fileSizeLimit,successTimeout:7200,removeTimeout:7200,onInit:function(){if(!ME.options.showfileList){$("#"+ID+"_btn-queue").hide()}if(ME.options.disabled){$("#"+ID).find(".upload_Btn").hide()}},onUploadSuccess:function(file,data,response){ME.addData.push(file.name);var obj=JSON.parse(data);if(ME.options.uploadSuccess&&obj.success){ME.options.uploadSuccess()}if(ME.options.uploadError&&!obj.success){ME.options.uploadError(obj.msg)}},onUploadError:function(file,errorCode,errorMsg,errorString){if(ME.options.uploadError){ME.options.uploadError()}}})},changeUrl:function(url){var ME=this;var ID=ME.element.context.id;$("#"+ID+"_btn").uploadify("changeUrl",url)},upload:function(){var ME=this;var ID=ME.element.context.id;$("#"+ID+"_btn").uploadify("upload","*")},delFile:function(disabled){var ME=this;var ID=ME.element.context.id;if(disabled=="true"){$("#"+ID+" .remove_file").each(function(){$(this).removeClass("glyphicon-remove-circle")})}$("#"+ID+" .remove_file").each(function(){$(this).unbind("click");$(this).bind("click",function(){ME.delData.push($(this).attr("index"));$(this).parent().parent().remove()})})},delFile:function(disabled){var ME=this;var ID=ME.element.context.id;if(disabled=="true"){$("#"+ID+" .remove_file").each(function(){$(this).removeClass("glyphicon-remove-circle")})}$("#"+ID+" .remove_file").each(function(){$(this).unbind("click");$(this).bind("click",function(){ME.delData.push($(this).attr("index"));$(this).parent().parent().remove()})})},getDelData:function(){return this.delData},getAddFileName:function(){return this.addData},getAddFileNum:function(){var ME=this;var ID=ME.element.context.id;var num=$("#"+ID+"_btn-queue").children("div").length;return num},disabled:function(disabled){var ME=this;var ID=ME.element.context.id;ME.options.disabled=disabled;$("#"+ID).find(".upload_Btn").hide()},flashChecker:function(){var hasFlash=0;var flashVersion=0;var isIE=
/*@cc_on!@*/
0;var message="";if(isIE){var swf=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(swf){hasFlash=1;VSwf=swf.GetVariable("$version");flashVersion=parseInt(VSwf.split(" ")[1].split(",")[0])}}else{if(navigator.plugins&&navigator.plugins.length>0){var swf=navigator.plugins["Shockwave Flash"];if(swf){hasFlash=1;var words=swf.description.split(" ");for(var i=0;i<words.length;++i){if(isNaN(parseInt(words[i]))){continue}flashVersion=parseInt(words[i])}}}}if(hasFlash){var browser=window.navigator.userAgent;var browserV="";if(browser.indexOf("Chrome/")!=-1){browser=browser.substring(browser.indexOf("Chrome/")+7);browserV=parseInt(browser.substring(0,browser.indexOf(".")));if(browserV>51&&flashVersion<23){message="(flash版本过低，无法实现文件上传!更新地址:https://get2.adobe.com/cn/flashplayer)"}}}else{message="(未安装flash，无法实现文件上传!安装地址:https://get2.adobe.com/cn/flashplayer)"}return message}})})(jQuery);(function(a,b){a.widget("RUI.RTabs",{options:{active:0,iframeInfo:null},_init:function(){},_create:function(){var e=this;var f=e.element.context.id;var c=e.options.iframeInfo;e.setActive(e.options.active);if(e.options.iframeInfo){for(var d=0;d<c.length;d++){a("#"+c[d].id+" div.tab_con").html('<iframe name="iframe-'+c[d].id+'" id="iframe-'+c[d].id+'" width="100%"  frameborder="0" ></iframe>')}}a("#"+f).find("iframe").each(function(g,h){a(h).height(e.getHeight(a(h)))});a("[name=iframe-"+c[e.options.active].id+"]").attr("src",c[e.options.active].url);a("#"+f+' a[data-toggle="tab"]').on("shown.bs.tab",function(h){var i=a(h.target).attr("href").substring(1);var g=a(h.target).parent("li").index();a("#"+f).find("iframe").each(function(j,k){a(k).height(e.getHeight(a(k)))});if(!a('[name="iframe-'+i+'"]').attr("src")){a('[name="iframe-'+i+'"]').attr("src",c[g].url)}})},setActive:function(d){var f=this;var g=f.element.context.id;var c=parseInt(d);var e=f.getTabNumbers();c=c<e?c:(e-1);a("#"+g+" ul>li:eq("+c+")").addClass("in active");a("#"+g+" .tab-content>.tab-pane:eq("+c+")").addClass("active")},getTabNumbers:function(){var d=this;var e=d.element.context.id;var c=a("#"+e+">ul li").length;return c},getHeight:function(f){var e=a(document).height();var g=0;var c=new Array();f.parents().each(function(h,i){c[h]=a(i).outerHeight(true)});for(var d=0;d<c.length-2;d++){g+=(c[d+1]-c[d])}e-=(g+5);return e}})})(jQuery);(function(a,b){a.widget("RUI.RCharts",{options:{width:"",height:"",type:"",dataTitle:[],xAxis:"",yAxis:"",xTitle:"",yTitle:"",dataUrl:"",title:"",subtext:"",eachName:"",eachValue:""},_init:function(){},_create:function(){var d=this;var c=d.element.context.id;a("#"+c).css({width:d.options.width,height:d.options.height});this.getData()},getData:function(){var d=this;var c=d.element.context.id;a.ajax({url:d.options.dataUrl,type:"GET",success:function(e){if(d.options.type=="bar"){d.setBar(e)}else{if(d.options.type=="line"){d.setLine(e)}else{d.setPie(e)}}},error:function(){}})},setBar:function(h){var c=this;var o=c.element.context.id;var n=echarts.init(document.getElementById(o));var m=[];var l;for(var f=0;f<c.options.dataTitle.length;f++){var p={name:c.options.dataTitle[f],type:c.options.type};m.push(p)}for(var g=0;g<h.length;g++){var d=[];l=[];for(var e=0;e<h[g].rows.length;e++){d.push(h[g].rows[e][c.options.yAxis]);l.push(h[g].rows[e][c.options.xAxis])}m[g].data=d}n.setOption({title:{text:c.options.title,subtext:c.options.subtext},tooltip:{trigger:"axis"},legend:{data:c.options.dataTitle},xAxis:[{name:c.options.xTitle,type:"category",data:l}],yAxis:[{name:c.options.yTitle,type:"value",splitArea:{show:true}}],series:m})},setPie:function(h){var g=this;var c=g.element.context.id;var d=echarts.init(document.getElementById(c));var f=[];f.push({type:"pie",radius:"55%",center:["50%","60%"]});var j=[];for(var e=0;e<h[0].rows.length;e++){j.push({value:h[0].rows[e][g.options.eachValue],name:h[0].rows[e][g.options.eachName]})}f[0].data=j;d.setOption({title:{text:g.options.title,subtext:g.options.subtext,x:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",x:"left",data:g.options.dataTitle},calculable:true,series:f})},setLine:function(h){var c=this;var o=c.element.context.id;var n=echarts.init(document.getElementById(o));var m=[];var l;for(var f=0;f<c.options.dataTitle.length;f++){var p={name:c.options.dataTitle[f],type:c.options.type};m.push(p)}for(var g=0;g<h.length;g++){var d=[];l=[];for(var e=0;e<h[g].rows.length;e++){d.push(h[g].rows[e][c.options.yAxis]);l.push(h[g].rows[e][c.options.xAxis])}m[g].data=d}n.setOption({title:{text:c.options.title,subtext:c.options.subtext},tooltip:{trigger:"axis"},legend:{data:c.options.dataTitle},xAxis:[{name:c.options.xTitle,boundaryGap:false,type:"category",data:l}],yAxis:[{name:c.options.yTitle,type:"value",splitArea:{show:true}}],series:m})}})})(jQuery);function clearCache(c){for(var a in window.sessionStorage){for(var b=0;b<c.length;b++){if(a.indexOf(c[b])!=-1){window.sessionStorage.removeItem(a)}}}}function clearAllCache(){window.sessionStorage.clear()}$.fn.doMask=function(){$(this).append('<div class="set_mask"></div>');$("div.set_mask").append('<div class="mask_message">正在处理中...</div>');$("div.set_mask").css({width:$(this).width(),height:$(this).height()});$("div.mask_message").css({left:($("div.set_mask").width()/2-125),top:($(window).height())/2-20})};$.fn.removeMask=function(){$("div.set_mask").remove()};$.fn.extend({AllSerialize:function(isJason){var $f=$(this);for(var i=0;i<$("input").length;i++){$("input").eq(i).val($.trim($("input").eq(i).val()))}var data=$(this).serialize();var $allchks=$(this).find(":checked");var $chks=$(this).find(":checkbox:not(:checked)");data=data.replace(/%E2%88%9A/g,"1");data=data.replace(/%C3%97/g,"1");if($("[role=defaultText]").length>0){var arr=data.split("&");$("[role=defaultText]").each(function(){var name=$(this).attr("name");var defaultText=$(this).siblings("span").html();var val=$(this).val();for(var i=0;i<arr.length;i++){if(arr[i].split("=")[0]==name){arr[i]=name+"="+defaultText+val;break}}});data=arr.join("&")}if($("[isMoney=true]").length>0){var arr=data.split("&");$("[isMoney=true]").each(function(){var name=$(this).attr("name");var val=$(this).val();val=val.replace(/,/g,"");for(var i=0;i<arr.length;i++){if(arr[i].split("=")[0]==name){arr[i]=name+"="+val;break}}});data=arr.join("&")}if($chks.length!=0||$allchks.length!=0){var nameArr=[];var tempStr="";$chks.each(function(){var chkName=$(this).attr("name");if(chkName){if($.inArray(chkName,nameArr)==-1&&$f.find(":checkbox[name='"+chkName+"']:checked").length==0){nameArr.push(chkName);tempStr+="&"+chkName+"=0"}}});data+=tempStr;return data}$allchks.each(function(){var str=$(this).attr("name");if(str){data=data.replace(eval("/"+str+"=on/"),str+"=1")}});if(isJason){var obj={};var keyvalue=[];var key="",value="";var paraString=data.split("&");for(var i in paraString){keyvalue=paraString[i].split("=");key=keyvalue[0];value=keyvalue[1];obj[key]=value}return decodeURIComponent(JSON.stringify(obj))}else{return data}}});function getRootPath_web(){var c=window.document.location.href;var d=window.document.location.pathname;var e=c.indexOf(d);var b=c.substring(0,e);var a=d.substring(0,d.substr(1).indexOf("/")+1);return(b+a)}function toGetNum(b){var a=/\d+/g;return b.match(a)}$(document).bind("keydown",function(a){var a=a||window.event;if(a.keyCode==8&&a.target.nodeName.toUpperCase()!="INPUT"&&a.target.nodeName.toUpperCase()!="TEXTAREA"){return false}});function FloatAdd(f,d,h){var c,b,a;try{c=f.toString().split(".")[1].length}catch(g){c=0}try{b=d.toString().split(".")[1].length}catch(g){b=0}a=Math.pow(10,Math.max(c,b));return toNbits((f*a+d*a)/a,h)}function FloatSub(f,d,i){var c,b,a,h;try{c=f.toString().split(".")[1].length}catch(g){c=0}try{b=d.toString().split(".")[1].length}catch(g){b=0}a=Math.pow(10,Math.max(c,b));h=(c>=b)?c:b;return toNbits(((f*a-d*a)/a).toFixed(h),i)}function FloatMul(d,b,h){var a=0,f=d.toString(),c=b.toString();try{a+=f.split(".")[1].length}catch(g){}try{a+=c.split(".")[1].length}catch(g){}return toNbits(Number(f.replace(".",""))*Number(c.replace(".",""))/Math.pow(10,a),h)}function FloatDiv(arg1,arg2,pos){var t1=0,t2=0,r1,r2;try{t1=arg1.toString().split(".")[1].length}catch(e){}try{t2=arg2.toString().split(".")[1].length}catch(e){}with(Math){r1=Number(arg1.toString().replace(".",""));r2=Number(arg2.toString().replace(".",""));return toNbits((r1/r2)*pow(10,t2-t1),pos)}}function toNbits(d,c){var b=1;for(var a=1;a<=parseInt(c);a++){b=b*10}if(parseFloat(d)==d){return Math.round(d*b)/b}else{return 0}};(function(a,b){a.widget("RUI.REditor",{options:{panelWidth:null,PanelHeight:600},UE:null,_init:function(){var d=this.element.context.id;if(!this.options.panelWidth){this.options.panelWidth=a("#"+d).parent().width()}var c=UE.getEditor("container",{initialFrameWidth:this.options.panelWidth,initialFrameHeight:this.options.panelHeight});this.UE=c},_create:function(){},setValue:function(d){var c=this;c.UE.ready(function(){c.UE.setContent(d)})},getValue:function(){var c=this.UE.getContent();return c}})})(jQuery);(function(a,b){a.widget("RUI.RForm",{options:{value:null},_create:function(){var f=this;var c=this.element.context.id;var d="";var e;if(f.options.value.rows.length<1){a.RMessage.alert("消息",f.options.value.msg,parent.closeWinFn);return}else{e=f.options.value.rows[0]}a("input,select,textarea").each(function(){d=a(this).attr("name");if(d){if(a(this).attr("combogrid")){if(e[d]){var h=d;if(d.indexOf("id")>0){d=d.substring(0,d.indexOf("id"))}var g=[e[h],e[d+"name"]];if(g[0]){a("#"+h).RComboGrid("setAllValue",g)}}}else{if(this.tagName=="SELECT"){if(e[d]){var g=[e[d+"value"],e[d]];if(g[0]){a("#"+d).RCombo("setAllValue",g)}}}else{if(a(this).attr("role")=="defaultText"){var j=a(this).siblings("span").html().length;var i=e[d].substring(j);a(this).val(i)}else{if(a(this).hasClass("hid_val")){if(e[d]){var g=[e[d+"value"],e[d]];a(this).val(e[d+"value"]);if(g[0]){a("#"+d).RCombo("setAllValue",g)}}}else{if(e[d]){a(this).val(e[d])}}}}}}});f.findCheckBox()},_init:function(){},findCheckBox:function(){var d=this;var c=this.element.context.id;a("#"+c).find("input[type=checkbox]").each(function(){if(a(this).attr("name")){if(a(this).attr("value")=="√"){a(this).RCheckbox("setChecked",true)}else{a(this).RCheckbox("setChecked",false)}}})},destroy:function(){a.Widget.prototype.destroy.call(this)}})})(jQuery);(function(a,b){a.widget("RUI.RCheckbox",{options:{viewtype:2,readonly:false,type:"",checked:false},_create:function(){var d=this;var c=d.element.context.id;a("#"+c).css({"-webkit-opacity":0,"-moz-opacity":0,opacity:0,filter:"alpha(opacity:0)"});if(d.options.readonly){if(d.options.checked){a("#"+c).prop("checked","checked");a("[for="+c+"]").addClass("ckx_wrap_active_n")}else{a("[for="+c+"]").addClass("ckx_wrap_n")}a("[for="+c+"]").bind("click",function(){return false})}else{if(d.options.checked){a("#"+c).prop("checked","checked");a("[for="+c+"]").addClass("ckx_wrap_active")}if(d.options.type=="radio"){a("[for="+c+"]").bind("click",function(){var f=a(this).attr("groupFor");var e=a(this).hasClass("ckx_radio_wrap_active");a("label[groupFor="+f+"]").removeClass("ckx_radio_wrap_active");a("input[groupFor="+f+"]").prop("checked",false);if(!e){a(this).addClass("ckx_radio_wrap_active");a("#"+c).prop("checked","checked")}return false})}else{a("[for="+c+"]").bind("click",function(){a(this).toggleClass("ckx_wrap_active")})}}},setReadOnly:function(d){var e=this;var c=e.element.context.id;if(d){a("#"+c).prop("checked","checked");a("[for="+c+"]").removeClass("ckx_wrap_active").addClass("ckx_wrap_active_n")}else{a("#"+c).prop("checked",false);a("[for="+c+"]").removeClass("ckx_wrap_active").addClass("ckx_wrap_n")}a("[for="+c+"]").unbind("click");a("[for="+c+"]").bind("click",function(){return false})},setChecked:function(d){var e=this;var c=e.element.context.id;if(d){if(e.options.type=="radio"){a("#"+c).prop("checked","checked");a("[for="+c+"]").addClass("ckx_radio_wrap_active")}else{a("#"+c).prop("checked","checked");a("[for="+c+"]").addClass("ckx_wrap_active")}}else{if(e.options.type=="radio"){a("#"+c).prop("checked",false);a("[for="+c+"]").removeClass("ckx_radio_wrap_active")}else{a("#"+c).prop("checked",false);a("[for="+c+"]").removeClass("ckx_wrap_active")}}},destroy:function(){a.Widget.prototype.destroy.call(this)}})})(jQuery);(function(a,b){a.widget("RUI.Rradio",{options:{viewtype:2,readonly:false,checked:false},_create:function(){var d=this;var c=d.element.context.id;a("#"+c).css({"-webkit-opacity":0,"-moz-opacity":0,opacity:0,filter:"alpha(opacity:0)"});if(d.options.readonly){if(d.options.checked){a("#"+c).prop("checked","checked");a("[for="+c+"]").addClass("rdo_wrap_active_n")}else{a("[for="+c+"]").addClass("rdo_wrap_n")}a("[for="+c+"]").bind("click",function(){return false})}else{if(d.options.checked){a("#"+c).prop("checked","checked");a("[for="+c+"]").addClass("rdo_wrap_active")}else{if(a("input[name = "+a("#"+c).attr("name")+"]").length>1){a("[for="+c+"]").bind("click",function(){var e=a(this).attr("groupFor");a("label[groupFor="+e+"]").removeClass("rdo_wrap_active");a(this).addClass("rdo_wrap_active")})}else{a("[for="+c+"]").bind("click",function(){a(this).addClass("rdo_wrap_active")})}}}},_bindEvent:function(){var c=this},setReadOnly:function(d){var e=this;var c=e.element.context.id;if(d){a("#"+c).prop("checked","checked");a("[for="+c+"]").removeClass("ckx_wrap_active").addClass("rdo_wrap_active_n")}else{a("#"+c).prop("checked",false);a("[for="+c+"]").removeClass("ckx_wrap_active").addClass("rdo_wrap_n")}a("[for="+c+"]").unbind("click");a("[for="+c+"]").bind("click",function(){return false})},setValue:function(c){var d=this},destroy:function(){a.Widget.prototype.destroy.call(this)}})})(jQuery);(function(a,b){a.widget("RUI.SimpleGrid",{options:{dataUrl:"",columns:null,pageSize:"",height:"",primaryKey:null,operateFn:[]},pageNum:null,totalpage:null,tabData:[],_create:function(){var f=this;var c=f.element.context.id;var d=a('<tr><th><input type="checkbox" /></th></tr>');for(var e=0;e<f.options.columns.length;e++){d.append("<th>"+f.options.columns[e].title+"</th>")}if(f.options.operateFn.length>0){d.append("<th>操作</th>")}a("#"+c+" .simple_title table").append(d);f.getData()},getData:function(e){var d=this;var c=d.element.context.id;if(!e){e={page:"1",rows:d.options.pageSize}}a.ajax({url:d.options.dataUrl,type:"post",dataType:"JSON",data:e,success:function(f){d.setTable(f.rows);d.setPage(f);d.goToPage();d.tabData=f.rows},error:function(){}})},setTable:function(f){var c=this;var n=c.element.context.id;var o=c.options.operateFn;a("#"+n+" .simple_data table").html("");for(var g=0;g<f.length;g++){var m="";if(c.options.primaryKey){m=f[g][c.options.primaryKey]}var p=a('<tr index="'+m+'"><td><input type="checkbox" /></td></tr>');for(var e=0;e<c.options.columns.length;e++){p.append("<td>"+f[g][c.options.columns[e].text]+"</td>")}var l=a("<td></td>");for(var d=0;d<o.length;d++){var h=a("<span></span>");h.append(o[d].text);h.bind("click",f[g],o[d].fn);l.append(h)}p.append(l);a("#"+n+" .simple_data table").append(p)}a("#"+n).find("span").bind("click",function(i){var i=i||window.event;i.stopPropagation()})},setPage:function(e){var d=this;var c=d.element.context.id;d.pageNum=e.page;d.totalpage=e.totalpage;a("#"+c+" .simple_page").html('<span class="simple_prev"><i class="fa fa-angle-left"></i></span><span class="simple_pageNum">'+e.page+'</span><span class="simple_next"><i class="fa fa-angle-right"></i></span>跳至<input type="text" value="'+e.page+'">页');a("#"+c+" .simple_prev").bind("click",function(){d.prev()});a("#"+c+" .simple_next").bind("click",function(){d.next()});d.setHeight();d.setWidth();d.selectRow();d.toDetail()},prev:function(){var d=this;var c=d.element.context.id;if(d.pageNum>1){d.getData({page:(--d.pageNum),rows:d.options.pageSize})}},next:function(){var d=this;var c=d.element.context.id;if(d.pageNum<d.totalpage){d.getData({page:(++d.pageNum),rows:d.options.pageSize})}},goToPage:function(){var d=this;var c=d.element.context.id;a("#"+c+" .simple_page input").bind("keyup",function(e){e=e||window.event;if(e.keyCode==13){var f=a(this).val();if(f<=d.totalpage&&f>=1){d.getData({page:f,rows:d.options.pageSize})}}})},setHeight:function(){var g=this;var d=g.element.context.id;if(g.options.height){a("#"+d+" .simple_data").height(g.options.height)}else{a("#"+d).parents("body").css({height:"100%"});a("#"+d).parents("html").css({height:"100%"});var f=0;var c=a("#"+d).siblings("div").length;for(var e=0;e<c;e++){f+=a("#"+d).siblings("div").eq(e).height()}f=f+165;a("#"+d+" .simple_data").css("height",(a("body").height()-f))}},setWidth:function(){var f=this;var c=f.element.context.id;var e=[];for(var d=0;d<a("#"+c+" .simple_data tr:first td").length;d++){e.push(a("#"+c+" .simple_data tr:first td").eq(d).width())}for(var d=0;d<e.length;d++){a("#"+c+" .simple_title th").eq(d).outerWidth(e[d])}if(a("#"+c+" .simple_title").width()>a("#"+c+" .simple_data table").width()){a("#"+c+" .simple_title table").width(a("#"+c+" .simple_title").width()-17)}},selectRow:function(){var d=this;var c=d.element.context.id;a("#"+c+" .simple_data tr").bind("click",function(){a(this).find("input").prop("checked",true);a(this).addClass("simple_select_row")});a("#"+c+" .simple_data tr input").bind("click",function(e){e=e||window.event;if(a(this).is(":checked")){a(this).parent().parent().addClass("simple_select_row")}else{a(this).parent().parent().removeClass("simple_select_row")}e.stopPropagation()});a("#"+c+" .simple_title input").bind("click",function(){if(a(this).is(":checked")){a("#"+c+" .simple_data input").prop("checked",true);a("#"+c+" .simple_data tr").addClass("simple_select_row")}else{a("#"+c+" .simple_data input").prop("checked",false);a("#"+c+" .simple_data tr").removeClass("simple_select_row")}})},getRows:function(){var e=this;var d=e.element.context.id;var c=[];a("#"+d+" .simple_data td input:checked").each(function(){c.push(a(this).parent().parent().attr("index"))});return c},getSelectedDatas:function(){var f=this;var e=f.element.context.id;var d=[];var c=f.tabData;a("#"+e+" .simple_data td input:checked").each(function(){var g=a(this).index();d.push(c[g])});return d},setGridParam:function(d){var c=this;d=a.extend({page:"1",rows:c.options.pageSize},d);c.getData(d)},toDetail:function(){var d=this;var c=d.element.context.id;a("#"+c+" tr a").bind("click",function(e){var e=e||window.event;e.stopPropagation()})},_init:function(){}})})(jQuery);(function(a,b){a.widget("RUI.DvTextField",{options:{selectable:true,viewtype:2,showTips:false,readonly:false,},ID:"",_create:function(){var f=this;var h=f.element.context.id;f.ID=h+"_wrap";if(f.options.readonly==true){a("#"+h).find("input").attr("readonly","readonly").css("background-color","#EEEEEE");a("#"+h).css("background-color","#EEEEEE")}if(f.options.showTips==true){a("#"+h).wrap('<div id="'+h+'_wrap" style="position:relative"></div>');var d=a("#"+h).find("input").attr("check");var g=d.split(",");var c=[];for(var e=0;e<g.length;e++){c=g[e].split(":");if(c[0]=="required"){a("#"+h+"_wrap").prepend('<span class="tips">*</span>')}}}},setDefaultValue:function(d){var c=this;var e=c.element.context.id;a("#"+e+" span").html(d)},_init:function(){}})})(jQuery);